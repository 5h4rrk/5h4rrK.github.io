<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  
    <title>Windows Objects: Structure, Headers, and Internal Mechanics :: 5h4rrk </title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="A deep dive into Windows objects, focusing on their structure, headers, and relationships. This blog covers key components like _OBJECT_HEADER, OBJECT_TYPE, and ObTypeIndexTable, providing insights into how Windows organizes and references objects." />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="http://localhost:1313/posts/windows-objects/" />







  
  
  
  
  
  <link rel="stylesheet" href="http://localhost:1313/styles.css">







  <link rel="shortcut icon" href="http://localhost:1313/img/theme-colors/orange.png">
  <link rel="apple-touch-icon" href="http://localhost:1313/img/theme-colors/orange.png">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Windows Objects: Structure, Headers, and Internal Mechanics">
<meta property="og:description" content="A deep dive into Windows objects, focusing on their structure, headers, and relationships. This blog covers key components like _OBJECT_HEADER, OBJECT_TYPE, and ObTypeIndexTable, providing insights into how Windows organizes and references objects." />
<meta property="og:url" content="http://localhost:1313/posts/windows-objects/" />
<meta property="og:site_name" content="5h4rrk " />

  
    <meta property="og:image" content="http://localhost:1313/img/favicon/orange.png">
  

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2025-03-12 08:23:06 &#43;0530 IST" />













  


</head>
<body class="orange">




<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/posts">
  <div class="logo">
    shark.exe [0]
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/tags">Tags</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/tags" >Tags</a></li>
        
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="http://localhost:1313/posts/windows-objects/">Windows Objects: Structure, Headers, and Internal Mechanics</a>
  </h1>
  <div class="post-meta"><time class="post-date">2025-03-12</time>
    
</div>

  
    <span class="post-tags">
      
      #<a href="http://localhost:1313/tags/windows-internals/">Windows Internals</a>&nbsp;
      
      #<a href="http://localhost:1313/tags/kernel-objects/">Kernel Objects</a>&nbsp;
      
      #<a href="http://localhost:1313/tags/debugging/">Debugging</a>&nbsp;
      
      #<a href="http://localhost:1313/tags/reverse-engineering/">Reverse Engineering</a>&nbsp;
      
    </span>
  
  



  

  <div class="post-content"><div>
        <h4 id="windows-pool">Windows Pool<a href="#windows-pool" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p>Windows Pool is memory allocated in kernel mode for core system components like drivers, can operate their activities. There are</p>
<ul>
<li>
<p><strong>Paged Pool</strong>: stays temporarily in memory. It would be paged out to disk when system memory runs out of memory. When it needs, it pulls it back to memory.</p>
</li>
<li>
<p><strong>Non Paged Pool</strong>: stays permanent in memory. It would be reserved for critical kernel objects or drivers that system cannot afford to page out.</p>
</li>
</ul>
<h4 id="objects">Objects<a href="#objects" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<ul>
<li>
<p>Kernel Objects are fundamental components managed by Object Manager.</p>
</li>
<li>
<p>Represents physical and logical resources like processes, threads, files, devices and so on.</p>
</li>
<li>
<p>Every Object has general structure in a pool page.</p>
</li>
<li>
<p>It has</p>
<ul>
<li>Pool Header</li>
<li>Optional Object Header  -&gt; there can be mulitple Optional object headers</li>
<li>Object header</li>
<li>Object Body</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">+---------------------+                           +---------------+
</span></span><span class="line"><span class="cl"><span class="p">|</span>  PsActiveProcessHead <span class="p">|</span> -----------------------&gt; <span class="p">|</span>    _EPROCESS   <span class="p">|</span>
</span></span><span class="line"><span class="cl">+---------------------+                           +---------------+
</span></span><span class="line"><span class="cl">                                                          ^
</span></span><span class="line"><span class="cl">                                                          <span class="p">|</span>              
</span></span><span class="line"><span class="cl">                                                          v   
</span></span><span class="line"><span class="cl">                                                    +------------+
</span></span><span class="line"><span class="cl">                                                    <span class="p">|</span>  _EPROCESS  <span class="p">|</span> 
</span></span><span class="line"><span class="cl">                                                    +------------+      
</span></span><span class="line"><span class="cl">                                                          ^
</span></span><span class="line"><span class="cl">                                                          <span class="p">|</span>              
</span></span><span class="line"><span class="cl">                                                          v              
</span></span><span class="line"><span class="cl">                                                    +------------+       
</span></span><span class="line"><span class="cl">                                                    <span class="p">|</span>  _EPROCESS  <span class="p">|</span> 
</span></span><span class="line"><span class="cl">                                                    +------------+
</span></span><span class="line"><span class="cl">                                                          .
</span></span><span class="line"><span class="cl">                                                          .
</span></span><span class="line"><span class="cl">                                                          .    
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Pool Object Representation
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    +-------------------------+
</span></span><span class="line"><span class="cl">    <span class="p">|</span>       Pool Header        <span class="p">|</span>  &lt;---- Contains metadata <span class="k">for</span> pool <span class="o">(</span>e.g., size, <span class="nb">type</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    +-------------------------+
</span></span><span class="line"><span class="cl">    <span class="p">|</span>  Optional Object Header  <span class="p">|</span>  &lt;---- Contains additional headers
</span></span><span class="line"><span class="cl">    +-------------------------+
</span></span><span class="line"><span class="cl">    <span class="p">|</span>      Object Header       <span class="p">|</span>  &lt;---- Key fields: Object Type, Object Size, Reference Count
</span></span><span class="line"><span class="cl">    +-------------------------+
</span></span><span class="line"><span class="cl">    <span class="p">|</span>      Object Body         <span class="p">|</span>  &lt;---- Actual data<span class="p">;</span> varies depending on the object <span class="nb">type</span>
</span></span><span class="line"><span class="cl">    <span class="p">|</span>  <span class="o">(</span>Process, Thread, etc<span class="o">)</span> <span class="p">|</span>         <span class="o">(</span>e.g., <span class="s2">&#34;Proc&#34;</span> <span class="k">for</span> processes, <span class="s2">&#34;Thre&#34;</span> <span class="k">for</span> threads, <span class="s2">&#34;File&#34;</span> <span class="k">for</span> files<span class="o">)</span>
</span></span><span class="line"><span class="cl">    +-------------------------+
</span></span><span class="line"><span class="cl">    
</span></span></code></pre></div><h4 id="inspecting-cmdexe">Inspecting cmd.exe<a href="#inspecting-cmdexe" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rs" data-lang="rs"><span class="line"><span class="cl"><span class="mi">0</span>: <span class="nc">kd</span><span class="o">&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">process</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">cmd</span><span class="p">.</span><span class="n">exe</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="no">PROCESS</span><span class="w"> 	
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">SessionId</span>: <span class="mi">1</span><span class="w">  </span><span class="n">Cid</span>: <span class="mi">1164</span><span class="w">    </span><span class="n">Peb</span>: <span class="mi">72</span><span class="n">ce659000</span><span class="w">  </span><span class="n">ParentCid</span>: <span class="mi">1148</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">DirBase</span>: <span class="mf">5e2</span><span class="n">bc002</span><span class="w">  </span><span class="n">ObjectTable</span>: <span class="nc">ffff99011473e500</span><span class="w">  </span><span class="n">HandleCount</span>: <span class="mf">245.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">Image</span>: <span class="nc">cmd</span><span class="p">.</span><span class="n">exe</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">0</span>: <span class="nc">kd</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="n">nt</span><span class="o">!</span><span class="no">_EPROCESS</span><span class="w"> </span><span class="n">ffffc509bf28b080</span><span class="w"> </span><span class="o">-</span><span class="n">y</span><span class="w"> </span><span class="n">Image</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x464</span><span class="w"> </span><span class="n">ImageNotifyDone</span><span class="w"> </span>: <span class="mi">0</span><span class="n">y1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x5a0</span><span class="w"> </span><span class="n">ImageFilePointer</span><span class="w"> </span>: <span class="mh">0xffffc509</span><span class="err">`</span><span class="n">c095e2b0</span><span class="w"> </span><span class="no">_FILE_OBJECT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x5a8</span><span class="w"> </span><span class="n">ImageFileName</span><span class="w"> </span>: <span class="p">[</span><span class="mi">15</span><span class="p">]</span><span class="w">  </span><span class="s">&#34;cmd.exe&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x5f4</span><span class="w"> </span><span class="n">ImagePathHash</span><span class="w"> </span>: <span class="mh">0xbd30981</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; !object ffffc509bf28b080
</span></span><span class="line"><span class="cl">Object: ffffc509bf28b080  Type: <span class="o">(</span>ffffc509b88ab900<span class="o">)</span> Process
</span></span><span class="line"><span class="cl">    ObjectHeader: ffffc509bf28b050 <span class="o">(</span>new version<span class="o">)</span>
</span></span><span class="line"><span class="cl">    HandleCount: <span class="m">7</span>  PointerCount: <span class="m">261732</span>
</span></span></code></pre></div><ul>
<li>There are 7 active handles. PointerCount is a very large that represents the total number of objects referenced till time.</li>
</ul>
<p><strong>Open Handles</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; !findhandle ffffc509bf28b080
</span></span><span class="line"><span class="cl">                                                              
</span></span><span class="line"><span class="cl">                   <span class="o">[</span>ffffc509b8884040 System<span class="o">]</span>
</span></span><span class="line"><span class="cl">  18ac: Entry ffff99010d4662b0 Granted Access 102a <span class="o">(</span>Protected<span class="o">)</span> <span class="o">(</span>Audit<span class="o">)</span>
</span></span><span class="line"><span class="cl">  2ab4: Entry ffff990112b41ad0 Granted Access 1fffff <span class="o">(</span>Protected<span class="o">)</span> <span class="o">(</span>Audit<span class="o">)</span>
</span></span><span class="line"><span class="cl">  2c98: Entry ffff9901137fe260 Granted Access 102a <span class="o">(</span>Protected<span class="o">)</span> <span class="o">(</span>Audit<span class="o">)</span>
</span></span><span class="line"><span class="cl">                                                              
</span></span><span class="line"><span class="cl">                   <span class="o">[</span>ffffc509bc16f080 csrss.exe<span class="o">]</span>
</span></span><span class="line"><span class="cl">   3a0: Entry ffff99010b5fce80 Granted Access 1fffff <span class="o">(</span>Protected<span class="o">)</span> <span class="o">(</span>Audit<span class="o">)</span>
</span></span><span class="line"><span class="cl">                                                              
</span></span><span class="line"><span class="cl">                   <span class="o">[</span>ffffc509bd20d140 lsass.exe<span class="o">]</span>
</span></span><span class="line"><span class="cl">  1214: Entry ffff990112379850 Granted Access <span class="m">1478</span> <span class="o">(</span>Protected<span class="o">)</span> <span class="o">(</span>Audit<span class="o">)</span>
</span></span><span class="line"><span class="cl">                                                              
</span></span><span class="line"><span class="cl">                   <span class="o">[</span>ffffc509bd415300 svchost.exe<span class="o">]</span>
</span></span><span class="line"><span class="cl">  2768: Entry ffff9901139c2da0 Granted Access <span class="m">1478</span> <span class="o">(</span>Protected<span class="o">)</span> <span class="o">(</span>Audit<span class="o">)</span>
</span></span><span class="line"><span class="cl">                                                              
</span></span><span class="line"><span class="cl">                   <span class="o">[</span>ffffc509c0ed2080 conhost.exe<span class="o">]</span>
</span></span><span class="line"><span class="cl">   120: Entry ffff990112455480 Granted Access 1fffff <span class="o">(</span>Protected<span class="o">)</span> <span class="o">(</span>Audit<span class="o">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; !trueref ffffc509bf28b080
</span></span><span class="line"><span class="cl">ffffc509bf28b080: HandleCount: <span class="m">7</span> PointerCount: <span class="m">261732</span> RealPointerCount: <span class="m">153</span>
</span></span></code></pre></div><ul>
<li>
<p><strong>HandleCount</strong> represents objects are accessed using a <strong>handle</strong>, which is standard way of accessing resources in windows.</p>
</li>
<li>
<p><strong>Real Pointer Count</strong>, another way to access the kernel object is through <strong>pointers</strong>, done in kernel mode.</p>
</li>
</ul>
<h5 id="object_header">OBJECT_HEADER<a href="#object_header" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rs" data-lang="rs"><span class="line"><span class="cl"><span class="mi">0</span>: <span class="nc">kd</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="n">nt</span><span class="o">!</span><span class="no">_OBJECT_HEADER</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x000</span><span class="w"> </span><span class="n">PointerCount</span><span class="w">     </span>: <span class="nc">Int8B</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x008</span><span class="w"> </span><span class="n">HandleCount</span><span class="w">      </span>: <span class="nc">Int8B</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x008</span><span class="w"> </span><span class="n">NextToFree</span><span class="w">       </span>: <span class="nc">Ptr64</span><span class="w"> </span><span class="n">Void</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x010</span><span class="w"> </span><span class="n">Lock</span><span class="w">             </span>: <span class="nc">_EX_PUSH_LOCK</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x018</span><span class="w"> </span><span class="n">TypeIndex</span><span class="w">        </span>: <span class="nc">UChar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x019</span><span class="w"> </span><span class="n">TraceFlags</span><span class="w">       </span>: <span class="nc">UChar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x019</span><span class="w"> </span><span class="n">DbgRefTrace</span><span class="w">      </span>: <span class="nc">Pos</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">Bit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x019</span><span class="w"> </span><span class="n">DbgTracePermanent</span><span class="w"> </span>: <span class="nc">Pos</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">Bit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01a</span><span class="w"> </span><span class="n">InfoMask</span><span class="w">         </span>: <span class="nc">UChar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">Flags</span><span class="w">            </span>: <span class="nc">UChar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">NewObject</span><span class="w">        </span>: <span class="nc">Pos</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">Bit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">KernelObject</span><span class="w">     </span>: <span class="nc">Pos</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">Bit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">KernelOnlyAccess</span><span class="w"> </span>: <span class="nc">Pos</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">Bit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">ExclusiveObject</span><span class="w">  </span>: <span class="nc">Pos</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">Bit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">PermanentObject</span><span class="w">  </span>: <span class="nc">Pos</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">Bit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">DefaultSecurityQuota</span><span class="w"> </span>: <span class="nc">Pos</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">Bit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">SingleHandleEntry</span><span class="w"> </span>: <span class="nc">Pos</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">Bit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">DeletedInline</span><span class="w">    </span>: <span class="nc">Pos</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">Bit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01c</span><span class="w"> </span><span class="n">Reserved</span><span class="w">         </span>: <span class="nc">Uint4B</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x020</span><span class="w"> </span><span class="n">ObjectCreateInfo</span><span class="w"> </span>: <span class="nc">Ptr64</span><span class="w"> </span><span class="no">_OBJECT_CREATE_INFORMATION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x020</span><span class="w"> </span><span class="n">QuotaBlockCharged</span><span class="w"> </span>: <span class="nc">Ptr64</span><span class="w"> </span><span class="n">Void</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x028</span><span class="w"> </span><span class="n">SecurityDescriptor</span><span class="w"> </span>: <span class="nc">Ptr64</span><span class="w"> </span><span class="n">Void</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x030</span><span class="w"> </span><span class="n">Body</span><span class="w">             </span>: <span class="nc">_QUAD</span><span class="w">  
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; dt nt!_QUAD
</span></span><span class="line"><span class="cl">   +0x000 UseThisFieldToCopy : Int8B
</span></span><span class="line"><span class="cl">   +0x000 DoNotUseThisField : Float
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">0: kd&gt; ?? sizeof<span class="o">(</span>_OBJECT_HEADER<span class="o">)</span>
</span></span><span class="line"><span class="cl">unsigned int64 0x38
</span></span></code></pre></div><p>The Body field is of type QUAD,  which overlaps with the actual object’s data. So, subtract 0x8 from 0x38.</p>
<p>In a 64-bit architecture,<code>_OBJECT_HEADER</code> structure size is 0x30 bytes. To obtain the starting address of <code>OBJECT_HEADER</code> from <code>OBJECT_BODY</code> address, simply subtract 0x30 bytes from <code>OBJECT_BODY</code> address.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rs" data-lang="rs"><span class="line"><span class="cl"><span class="mi">0</span>: <span class="nc">kd</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="n">nt</span><span class="o">!</span><span class="no">_OBJECT_HEADER</span><span class="w"> </span><span class="n">ffffc509bf28b080</span><span class="o">-</span><span class="mi">30</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x000</span><span class="w"> </span><span class="n">PointerCount</span><span class="w">     </span>: <span class="mi">0</span><span class="n">n261732</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x008</span><span class="w"> </span><span class="n">HandleCount</span><span class="w">      </span>: <span class="mi">0</span><span class="n">n7</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x008</span><span class="w"> </span><span class="n">NextToFree</span><span class="w">       </span>: <span class="mh">0x00000000</span><span class="err">`</span><span class="mi">00000007</span><span class="w"> </span><span class="n">Void</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x010</span><span class="w"> </span><span class="n">Lock</span><span class="w">             </span>: <span class="nc">_EX_PUSH_LOCK</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x018</span><span class="w"> </span><span class="n">TypeIndex</span><span class="w">        </span>: <span class="mh">0xc</span><span class="w"> </span><span class="na">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x019</span><span class="w"> </span><span class="n">TraceFlags</span><span class="w">       </span>: <span class="mi">0</span><span class="w"> </span><span class="na">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x019</span><span class="w"> </span><span class="n">DbgRefTrace</span><span class="w">      </span>: <span class="mi">0</span><span class="n">y0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x019</span><span class="w"> </span><span class="n">DbgTracePermanent</span><span class="w"> </span>: <span class="mi">0</span><span class="n">y0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01a</span><span class="w"> </span><span class="n">InfoMask</span><span class="w">         </span>: <span class="mh">0x88</span><span class="w"> </span><span class="na">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">Flags</span><span class="w">            </span>: <span class="mi">0</span><span class="w"> </span><span class="na">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">NewObject</span><span class="w">        </span>: <span class="mi">0</span><span class="n">y0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">KernelObject</span><span class="w">     </span>: <span class="mi">0</span><span class="n">y0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">KernelOnlyAccess</span><span class="w"> </span>: <span class="mi">0</span><span class="n">y0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">ExclusiveObject</span><span class="w">  </span>: <span class="mi">0</span><span class="n">y0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">PermanentObject</span><span class="w">  </span>: <span class="mi">0</span><span class="n">y0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">DefaultSecurityQuota</span><span class="w"> </span>: <span class="mi">0</span><span class="n">y0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">SingleHandleEntry</span><span class="w"> </span>: <span class="mi">0</span><span class="n">y0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">DeletedInline</span><span class="w">    </span>: <span class="mi">0</span><span class="n">y0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01c</span><span class="w"> </span><span class="n">Reserved</span><span class="w">         </span>: <span class="mh">0x7ffe</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x020</span><span class="w"> </span><span class="n">ObjectCreateInfo</span><span class="w"> </span>: <span class="mh">0xffffc509</span><span class="err">`</span><span class="n">bae86cc0</span><span class="w"> </span><span class="no">_OBJECT_CREATE_INFORMATION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x020</span><span class="w"> </span><span class="n">QuotaBlockCharged</span><span class="w"> </span>: <span class="mh">0xffffc509</span><span class="err">`</span><span class="n">bae86cc0</span><span class="w"> </span><span class="n">Void</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x028</span><span class="w"> </span><span class="n">SecurityDescriptor</span><span class="w"> </span>: <span class="mh">0xffff9901</span><span class="err">`</span><span class="mi">11</span><span class="n">fa936e</span><span class="w"> </span><span class="n">Void</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x030</span><span class="w"> </span><span class="n">Body</span><span class="w">             </span>: <span class="nc">_QUAD</span><span class="w">
</span></span></span></code></pre></div><ul>
<li>
<p>InfoMask is 0x88.</p>
</li>
<li>
<p>TraceFlags is an union of <strong>DbgRefTrace</strong> (0th bit) and <strong>DbgTracePermanent</strong>(1st bit). When the <strong>DbgRefTrace</strong> flag is set, it enables the tracking of reference count changes for the associated object. This allows developers and system administrators to monitor how many references exist to a particular object.</p>
</li>
<li>
<p>PermanentObject = 0, which means the process would be deleted once PointerCount and HandleCount reaches to 0. If PermanentObject=1, the object won&rsquo;t be deleted the count drops to 0.</p>
</li>
<li>
<p>ObjectCreateInfo is a strucutre of _OBJECT_CREATE_INFORMATION, which maintains information about Process Creation Attributes, Namespace where it is created, Charged Paged (amount of memory allocated from the paged pool that is currently in use by the system), Non-Paged Pool and so on</p>
</li>
<li>
<p>In the older version of Windows, <code>_OBJECT_HEADER-&gt;Type</code> used to point to <code>OBJECT_TYPE</code>.</p>
</li>
<li>
<p>From Windows 7 onwards, it changed to 8 bit value and stored at <code>_OBJECT_HEADER-&gt;TypeIndex</code>. It points to index to a data structure <code>nt!ObTypeIndexTable</code>, which is an array of pointers of <code>_OBJECT_TYPE</code>.</p>
</li>
</ul>
<h5 id="object_header-flags">OBJECT_HEADER Flags<a href="#object_header-flags" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#define OB_FLAG_NEW_OBJECT              0x01 </span><span class="c1">// NewObject (New Object Created, not exists in Pool)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define OB_FLAG_KERNEL_OBJECT           0x02 </span><span class="c1">// KernelObject (Object can only have Kernel handles)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define OB_FLAG_CREATOR_INFO            0x04 </span><span class="c1">// KernelOnlyAccess (Kernel can only open &amp; access handles)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define OB_FLAG_EXCLUSIVE_OBJECT        0x08 </span><span class="c1">// ExclusiveObject (Process who created can only open &amp; access it)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define OB_FLAG_PERMANENT_OBJECT        0x10 </span><span class="c1">// PermanentObject (Persits even HandleCount &amp; PointerCount drops to 0)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define OB_FLAG_DEFAULT_SECURITY_QUOTA  0x20 </span><span class="c1">// DefaultSecurityQuota (defines SecurityDescriptor)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define OB_FLAG_SINGLE_HANDLE_ENTRY     0x40 </span><span class="c1">// SingleHandleEntry (Only contains one entry OBJECT_HEADER_HANDLE_INFO )
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define OB_FLAG_DELETED_INLINE          0x80 </span><span class="c1">// DeletedInline (Object in queue for deletion)
</span></span></span></code></pre></div><h5 id="optional-objectheader">Optional ObjectHeader<a href="#optional-objectheader" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<table>
  <thead>
      <tr>
          <th>Optional Object Header</th>
          <th>(ObpInfoMaskToOffset)</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>_OBJECT_HEADER_CREATOR_INFO</td>
          <td>0                    = 0x1</td>
      </tr>
      <tr>
          <td>_OBJECT_HEADER_NAME_INFO</td>
          <td>InfoMask &amp; 0x3       = 0x2</td>
      </tr>
      <tr>
          <td>_OBJECT_HEADER_HANDLE_INFO</td>
          <td>InfoMask &amp; 0x7       = 0x4</td>
      </tr>
      <tr>
          <td>_OBJECT_HEADER_QUOTA_INFO</td>
          <td>InfoMask &amp; 0xF       = 0x8</td>
      </tr>
      <tr>
          <td>_OBJECT_HEADER_PROCESS_INFO</td>
          <td>InfoMask &amp; 0x1F      = 0x10</td>
      </tr>
      <tr>
          <td>_OBJECT_HEADER_AUDIT_INFO</td>
          <td>InfoMask &amp; 0x3F      = 0x20</td>
      </tr>
      <tr>
          <td>_OBJECT_HEADER_EXTENDED_INFO</td>
          <td>InfoMask &amp; 0x7F      = 0x40</td>
      </tr>
      <tr>
          <td>_OBJECT_HEADER_PADDING_INFO</td>
          <td>InfoMask &amp; 0xFF      = 0x80</td>
      </tr>
  </tbody>
</table>
<p>InfoMask : <code>0x88</code> -&gt; <strong>_OBJECT_HEADER_QUOTA_INFO</strong></p>
<p><strong>Decoding InfoMask</strong></p>
<ul>
<li>Corresponding ResultBit for _OBJECT_HEADER_QUOTA_INFO is 0x08.</li>
<li>Subtract ResultBit from InfoMask i.e. InfoMask - ResultBit = 0x88 - 0x8 = 0x80</li>
<li>After subtraction, it points to the next Optional Header.</li>
<li>Again, Update the InfoMask Value and Calculate it. It will give  _OBJECT_HEADER_PADDING_INFO</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">InfoMask</span> <span class="o">=</span> <span class="mh">0x88</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">OptionalHeaders</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;_OBJECT_HEADER_CREATOR_INFO&#34;</span><span class="p">,</span> <span class="s2">&#34;_OBJECT_HEADER_NAME_INFO&#34;</span><span class="p">,</span> <span class="s2">&#34;_OBJECT_HEADER_HANDLE_INFO&#34;</span><span class="p">,</span> <span class="s2">&#34;_OBJECT_HEADER_QUOTA_INFO&#34;</span><span class="p">,</span> <span class="s2">&#34;_OBJECT_HEADER_PROCESS_INFO&#34;</span><span class="p">,</span> <span class="s2">&#34;_OBJECT_HEADER_AUDIT_INFO&#34;</span><span class="p">,</span> <span class="s2">&#34;_OBJECT_HEADER_EXTENDED_INFO&#34;</span><span class="p">,</span> <span class="s2">&#34;_OBJECT_HEADER_PADDING_INFO&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">MaskBit</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0F</span><span class="p">,</span> <span class="mh">0x1F</span><span class="p">,</span> <span class="mh">0x3F</span><span class="p">,</span> <span class="mh">0x7F</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ResultBit</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="n">InfoMask</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">OptionalHeaders</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span><span class="p">(</span><span class="n">ResultBit</span><span class="p">[</span><span class="n">_</span><span class="p">]</span> <span class="o">==</span> <span class="n">MaskBit</span><span class="p">[</span><span class="n">_</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">InfoMask</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">         <span class="nb">print</span><span class="p">(</span><span class="n">OptionalHeaders</span><span class="p">[</span><span class="n">_</span><span class="p">])</span> 
</span></span><span class="line"><span class="cl">         <span class="n">InfoMask</span> <span class="o">-=</span> <span class="n">ResultBit</span><span class="p">[</span><span class="n">_</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Output: </span>
</span></span><span class="line"><span class="cl"><span class="c1">#_OBJECT_HEADER_QUOTA_INFO</span>
</span></span><span class="line"><span class="cl"><span class="c1">#_OBJECT_HEADER_PADDING_INFO</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rs" data-lang="rs"><span class="line"><span class="cl"><span class="mi">0</span>: <span class="nc">kd</span><span class="o">&gt;</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="n">ffffc509bf28b080</span><span class="o">-</span><span class="mi">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ffffc509</span><span class="err">`</span><span class="n">bf28b000</span><span class="w">  </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="n">d0</span><span class="w"> </span><span class="mi">02</span><span class="w"> </span><span class="mi">50</span><span class="w"> </span><span class="mi">72</span><span class="w"> </span><span class="mi">6</span><span class="n">f</span><span class="w"> </span><span class="mi">63</span><span class="o">-</span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">  </span><span class="o">....</span><span class="n">Proc</span><span class="o">........</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ffffc509</span><span class="err">`</span><span class="n">bf28b010</span><span class="w">  </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="o">-</span><span class="mi">8</span><span class="n">e</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">  </span><span class="o">................</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ffffc509</span><span class="err">`</span><span class="n">bf28b020</span><span class="w">  </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="o">-</span><span class="mi">01</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">53</span><span class="w"> </span><span class="mi">5</span><span class="n">e</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">  </span><span class="o">........</span><span class="p">.</span><span class="mi">0</span><span class="n">S</span><span class="o">^</span><span class="w"> </span><span class="o">..</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ffffc509</span><span class="err">`</span><span class="n">bf28b030</span><span class="w">  </span><span class="mi">00</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">48</span><span class="w"> </span><span class="mi">0</span><span class="n">c</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="o">-</span><span class="mi">78</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="n">fe</span><span class="w"> </span><span class="mi">7</span><span class="n">f</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">  </span><span class="o">....</span><span class="n">H</span><span class="o">..</span><span class="p">.</span><span class="n">x</span><span class="o">......</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ffffc509</span><span class="err">`</span><span class="n">bf28b040</span><span class="w">  </span><span class="n">c0</span><span class="w"> </span><span class="mi">6</span><span class="n">c</span><span class="w"> </span><span class="n">e8</span><span class="w"> </span><span class="n">ba</span><span class="w"> </span><span class="mi">09</span><span class="w"> </span><span class="n">c5</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="o">-</span><span class="mi">00</span><span class="w"> </span><span class="n">e0</span><span class="w"> </span><span class="mi">05</span><span class="w"> </span><span class="mi">5</span><span class="n">e</span><span class="w"> </span><span class="n">fe</span><span class="w"> </span><span class="mi">7</span><span class="n">f</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">  </span><span class="p">.</span><span class="n">l</span><span class="o">........</span><span class="p">.</span><span class="o">^....</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ffffc509</span><span class="err">`</span><span class="n">bf28b050</span><span class="w">  </span><span class="mi">64</span><span class="w"> </span><span class="n">fe</span><span class="w"> </span><span class="mi">03</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="o">-</span><span class="mi">07</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">  </span><span class="n">d</span><span class="o">..............</span><span class="p">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ffffc509</span><span class="err">`</span><span class="n">bf28b060</span><span class="w">  </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="o">-</span><span class="mi">0</span><span class="n">c</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">88</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="n">fe</span><span class="w"> </span><span class="mi">7</span><span class="n">f</span><span class="w"> </span><span class="mi">00</span><span class="w"> </span><span class="mi">00</span><span class="w">  </span><span class="o">................</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">ffffc509</span><span class="err">`</span><span class="n">bf28b070</span><span class="w">  </span><span class="n">c0</span><span class="w"> </span><span class="mi">6</span><span class="n">c</span><span class="w"> </span><span class="n">e8</span><span class="w"> </span><span class="n">ba</span><span class="w"> </span><span class="mi">09</span><span class="w"> </span><span class="n">c5</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="o">-</span><span class="mi">6</span><span class="n">e</span><span class="w"> </span><span class="mi">93</span><span class="w"> </span><span class="n">fa</span><span class="w"> </span><span class="mi">11</span><span class="w"> </span><span class="mi">01</span><span class="w"> </span><span class="mi">99</span><span class="w"> </span><span class="n">ff</span><span class="w"> </span><span class="n">ff</span><span class="w">  </span><span class="p">.</span><span class="n">l</span><span class="o">......</span><span class="n">n</span><span class="o">......</span><span class="p">.</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; dt ntkrnlmp!_OBJECT_HEADER_*
</span></span><span class="line"><span class="cl">          ntkrnlmp!_OBJECT_HEADER_QUOTA_INFO
</span></span><span class="line"><span class="cl">          ntkrnlmp!_OBJECT_HEADER_PROCESS_INFO
</span></span><span class="line"><span class="cl">          ntkrnlmp!_OBJECT_HEADER_HANDLE_INFO
</span></span><span class="line"><span class="cl">          ntkrnlmp!_OBJECT_HEADER_NAME_INFO
</span></span><span class="line"><span class="cl">          ntkrnlmp!_OBJECT_HEADER_CREATOR_INFO
</span></span><span class="line"><span class="cl">          ntkrnlmp!_OBJECT_HEADER_AUDIT_INFO
</span></span><span class="line"><span class="cl">          ntkrnlmp!_OBJECT_HEADER_EXTENDED_INFO
</span></span><span class="line"><span class="cl">          ntkrnlmp!_OBJECT_HEADER_PADDING_INFO
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">// OBJECT_BODY - OBJECT_HEADER_SIZE - _OBJECT_HEADER_QUOTA_INFO_SIZE
</span></span><span class="line"><span class="cl">0: kd&gt; ? ffffc509bf28b080-30-20
</span></span><span class="line"><span class="cl">Evaluate expression: -64829324218320 <span class="o">=</span> ffffc509<span class="sb">`</span>bf28b030
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">0: kd&gt;  dt nt!_OBJECT_HEADER_QUOTA_INFO ffffc509<span class="sb">`</span>bf28b050-20
</span></span><span class="line"><span class="cl">   +0x000 PagedPoolCharge  : 0x1000
</span></span><span class="line"><span class="cl">   +0x004 NonPagedPoolCharge : 0xc48
</span></span><span class="line"><span class="cl">   +0x008 SecurityDescriptorCharge : 0x78
</span></span><span class="line"><span class="cl">   +0x00c Reserved1        : 0x7ffe
</span></span><span class="line"><span class="cl">   +0x010 SecurityDescriptorQuotaBlock : 0xffffc509<span class="sb">`</span>bae86cc0 Void
</span></span><span class="line"><span class="cl">   +0x018 Reserved2        : 0x00007ffe<span class="sb">`</span>5e05e000
</span></span></code></pre></div><p>Objects are always created with headers attached to the object body. However, the number of headers depends entirely on how the object is created. In Kernel, Windows maintains an array of all possible combinations of headers and stores the value in ObpInfoMaskToOffset. Just say, I used <code>_OBJECT_HEADER_QUOTA_INFO</code>, then size would be 0x20. If I used two different headers, then InfoMask value would be sum of size of both headers result bit.</p>
<h5 id="locating-object_header">Locating OBJECT_HEADER<a href="#locating-object_header" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<p>The Optional Headers would appear before main OBJECT_HEADER and corresponding OptionalHeader result bit value would be stored in InfoMask.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rs" data-lang="rs"><span class="line"><span class="cl"><span class="c1">// ObpInfoMaskToOffset + ResultBit Value of QUOTA_INFO
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mi">0</span>: <span class="nc">kd</span><span class="o">&gt;</span><span class="w"> </span><span class="n">db</span><span class="w"> </span><span class="n">ObpInfoMaskToOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">0x8</span><span class="w"> </span><span class="n">L1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">fffff807</span><span class="err">`</span><span class="mi">1</span><span class="n">ec3de28</span><span class="w">  </span><span class="mi">20</span><span class="w">   
</span></span></span></code></pre></div><ul>
<li>Subtract it from <code>_OBJECT_HEADER -  _OBJECT_HEADER_QUOTA_INFO</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rs" data-lang="rs"><span class="line"><span class="cl"><span class="mi">0</span>: <span class="nc">kd</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="n">nt</span><span class="o">!</span><span class="no">_OBJECT_HEADER_QUOTA_INFO</span><span class="w"> </span><span class="n">ffffc509</span><span class="err">`</span><span class="n">bf28b050</span><span class="o">-</span><span class="mi">20</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x000</span><span class="w"> </span><span class="n">PagedPoolCharge</span><span class="w">  </span>: <span class="mh">0x1000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x004</span><span class="w"> </span><span class="n">NonPagedPoolCharge</span><span class="w"> </span>: <span class="mh">0xc48</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x008</span><span class="w"> </span><span class="n">SecurityDescriptorCharge</span><span class="w"> </span>: <span class="mh">0x78</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x00c</span><span class="w"> </span><span class="n">Reserved1</span><span class="w">        </span>: <span class="mh">0x7ffe</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x010</span><span class="w"> </span><span class="n">SecurityDescriptorQuotaBlock</span><span class="w"> </span>: <span class="mh">0xffffc509</span><span class="err">`</span><span class="n">bae86cc0</span><span class="w"> </span><span class="n">Void</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x018</span><span class="w"> </span><span class="n">Reserved2</span><span class="w">        </span>: <span class="mh">0x00007ffe</span><span class="err">`</span><span class="mf">5e05</span><span class="n">e000</span><span class="w">
</span></span></span></code></pre></div><ul>
<li>When system opens any handles, it consumes system resources, and this keeps track of those for that given Object.</li>
</ul>
<h5 id="optional-object-header-structures">Optional Object Header Structures<a href="#optional-object-header-structures" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; dt ntkrnlmp!_OBJECT_HEADER_PROCESS_INFO
</span></span><span class="line"><span class="cl">   +0x000 ExclusiveProcess : Ptr64 _EPROCESS
</span></span><span class="line"><span class="cl">   +0x008 Reserved         : Uint8B
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rs" data-lang="rs"><span class="line"><span class="cl"><span class="mi">0</span>: <span class="nc">kd</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="n">ntkrnlmp</span><span class="o">!</span><span class="no">_OBJECT_HEADER_HANDLE_INFO</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x000</span><span class="w"> </span><span class="n">HandleCountDataBase</span><span class="w"> </span>: <span class="nc">Ptr64</span><span class="w"> </span><span class="no">_OBJECT_HANDLE_COUNT_DATABASE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x000</span><span class="w"> </span><span class="n">SingleEntry</span><span class="w">      </span>: <span class="nc">_OBJECT_HANDLE_COUNT_ENTRY</span><span class="w">
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; dt nt!_OBJECT_HANDLE_COUNT_DATABASE
</span></span><span class="line"><span class="cl">   +0x000 CountEntries     : Uint4B
</span></span><span class="line"><span class="cl">   +0x008 HandleCountEntries : <span class="o">[</span>1<span class="o">]</span> _OBJECT_HANDLE_COUNT_ENTRY
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; dt nt!_OBJECT_HANDLE_COUNT_ENTRY
</span></span><span class="line"><span class="cl">   +0x000 Process          : Ptr64 _EPROCESS
</span></span><span class="line"><span class="cl">   +0x008 HandleCount      : Pos 0, <span class="m">24</span> Bits
</span></span><span class="line"><span class="cl">   +0x008 LockCount        : Pos 24, <span class="m">8</span> Bits
</span></span></code></pre></div><ul>
<li>Has entries of handles for per process</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; dt ntkrnlmp!_OBJECT_HEADER_NAME_INFO
</span></span><span class="line"><span class="cl">   +0x000 Directory        : Ptr64 _OBJECT_DIRECTORY
</span></span><span class="line"><span class="cl">   +0x008 Name             : _UNICODE_STRING
</span></span><span class="line"><span class="cl">   +0x018 ReferenceCount   : Int4B
</span></span><span class="line"><span class="cl">   +0x01c Reserved         : Uint4B
</span></span></code></pre></div><ul>
<li>Has Object name which makes it visible to other objects</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; dt ntkrnlmp!_OBJECT_HEADER_CREATOR_INFO   
</span></span><span class="line"><span class="cl">   +0x000 TypeList         : _LIST_ENTRY
</span></span><span class="line"><span class="cl">   +0x010 CreatorUniqueProcess : Ptr64 Void
</span></span><span class="line"><span class="cl">   +0x018 CreatorBackTraceIndex : Uint2B
</span></span><span class="line"><span class="cl">   +0x01a Reserved1        : Uint2B
</span></span><span class="line"><span class="cl">   +0x01c Reserved2        : Uint4B
</span></span></code></pre></div><ul>
<li>Links same-type objects, tracks creating process, and captures backtrace.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; dt ntkrnlmp!_OBJECT_HEADER_AUDIT_INFO
</span></span><span class="line"><span class="cl">   +0x000 SecurityDescriptor : Ptr64 Void
</span></span><span class="line"><span class="cl">   +0x008 Reserved         : Uint8B
</span></span></code></pre></div><ul>
<li>Has a pointer to Security Descriptor which was used while creating an Object. Used for File Objects to track audit.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; dt ntkrnlmp!_OBJECT_HEADER_EXTENDED_INFO
</span></span><span class="line"><span class="cl">   +0x000 Footer           : Ptr64 _OBJECT_FOOTER   
</span></span><span class="line"><span class="cl">   +0x008 Reserved         : Uint8B
</span></span></code></pre></div><ul>
<li>Has a pointer to _OBJECT_FOOTER</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; dt ntkrnlmp!_OBJECT_HEADER_PADDING_INFO
</span></span><span class="line"><span class="cl">   +0x000 PaddingAmount    : Uint4B                  -
</span></span></code></pre></div><ul>
<li>It&rsquo;s just for alignment of object body.</li>
</ul>
<p><img src="/posts/windows-objects/image-3.png" alt="alt text"></p>
<h5 id="object_header-typeindex">OBJECT_HEADER TypeIndex<a href="#object_header-typeindex" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<p>In older versions of Windows,<code>Type</code> field used to point to <code>_OBJECT_TYPE</code> structure. Starting with Windows 7, <code>TypeIndex</code> field is introduced, which stores an encoded value. When decoded, it provides an index that is used to locate <code>_OBJECT_TYPE</code> structure within <code>ObTypeIndexTable</code> array.</p>
<p>Now, Let&rsquo;s look into <strong>TypeIndex</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rs" data-lang="rs"><span class="line"><span class="cl"><span class="mi">0</span>: <span class="nc">kd</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="n">nt</span><span class="o">!</span><span class="no">_OBJECT_HEADER</span><span class="w"> </span><span class="n">ffffc509bf28b080</span><span class="o">-</span><span class="mi">30</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x000</span><span class="w"> </span><span class="n">PointerCount</span><span class="w">     </span>: <span class="mi">0</span><span class="n">n261732</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x008</span><span class="w"> </span><span class="n">HandleCount</span><span class="w">      </span>: <span class="mi">0</span><span class="n">n7</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x008</span><span class="w"> </span><span class="n">NextToFree</span><span class="w">       </span>: <span class="mh">0x00000000</span><span class="err">`</span><span class="mi">00000007</span><span class="w"> </span><span class="n">Void</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x010</span><span class="w"> </span><span class="n">Lock</span><span class="w">             </span>: <span class="nc">_EX_PUSH_LOCK</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x018</span><span class="w"> </span><span class="n">TypeIndex</span><span class="w">        </span>: <span class="mh">0xc</span><span class="w"> </span><span class="na">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x019</span><span class="w"> </span><span class="n">TraceFlags</span><span class="w">       </span>: <span class="mi">0</span><span class="w"> </span><span class="na">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x019</span><span class="w"> </span><span class="n">DbgRefTrace</span><span class="w">      </span>: <span class="mi">0</span><span class="n">y0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x019</span><span class="w"> </span><span class="n">DbgTracePermanent</span><span class="w"> </span>: <span class="mi">0</span><span class="n">y0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01a</span><span class="w"> </span><span class="n">InfoMask</span><span class="w">         </span>: <span class="mh">0x88</span><span class="w"> </span><span class="na">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">Flags</span><span class="w">            </span>: <span class="mi">0</span><span class="w"> </span><span class="na">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">....</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">....</span><span class="w">
</span></span></span></code></pre></div><p>TypeIndex : 0x0c</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; x nt!ObTypeIndexTable 
</span></span><span class="line"><span class="cl">fffff807<span class="sb">`</span>1ed14e80 nt!ObTypeIndexTable <span class="o">=</span> &lt;no <span class="nb">type</span> information&gt;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; x nt!ObGetObjectType
</span></span><span class="line"><span class="cl">fffff807<span class="sb">`</span>1e6e7a50 nt!ObGetObjectType <span class="o">(</span>ObGetObjectType<span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">0: kd&gt; uf nt!ObGetObjectType
</span></span><span class="line"><span class="cl">nt!ObGetObjectType:
</span></span><span class="line"><span class="cl">fffff807<span class="sb">`</span>1e6e7a50 488d41d0        lea     rax,<span class="o">[</span>rcx-30h<span class="o">]</span>			 <span class="p">;</span> _OBJECT_HEADER 
</span></span><span class="line"><span class="cl">fffff807<span class="sb">`</span>1e6e7a54 0fb649e8        movzx   ecx,byte ptr <span class="o">[</span>rcx-18h<span class="o">]</span> <span class="p">;</span> _OBJECT_HEADER-&gt;TypeIndex
</span></span><span class="line"><span class="cl">fffff807<span class="sb">`</span>1e6e7a58 48c1e808        shr     rax,8					 <span class="p">;</span> _OBJECT_HEADER &gt;&gt; <span class="m">8</span> 
</span></span><span class="line"><span class="cl">fffff807<span class="sb">`</span>1e6e7a5c 0fb6c0          movzx   eax,al				 <span class="p">;</span> <span class="o">(</span>_OBJECT_HEADER &gt;&gt; 8<span class="o">)</span> <span class="p">&amp;</span> 0xff
</span></span><span class="line"><span class="cl">fffff807<span class="sb">`</span>1e6e7a5f 4833c1          xor     rax,rcx				 <span class="p">;</span>  <span class="o">((</span>_OBJECT_HEADER &gt;&gt; 8<span class="o">)</span> <span class="p">&amp;</span> 0xff <span class="o">)</span> ^ <span class="o">(</span>_OBJECT_HEADER-&gt;TypeIndex<span class="o">)</span>
</span></span><span class="line"><span class="cl">fffff807<span class="sb">`</span>1e6e7a62 0fb60dc3cc6200  movzx   ecx,byte ptr <span class="o">[</span>nt!ObHeaderCookie <span class="o">(</span>fffff807<span class="sb">`</span>1ed1472c<span class="o">)]</span>
</span></span><span class="line"><span class="cl">fffff807<span class="sb">`</span>1e6e7a69 4833c1          xor     rax,rcx				 <span class="p">;</span> <span class="p">;</span> <span class="o">(((</span>_OBJECT_HEADER &gt;&gt; 8<span class="o">)</span> <span class="p">&amp;</span> 0xff <span class="o">)</span> ^ <span class="o">(</span>_OBJECT_HEADER-&gt;TypeIndex<span class="o">)</span> <span class="o">)</span> ^ <span class="o">((</span>nt!ObHeaderCookie<span class="o">)</span> <span class="p">&amp;</span> 0xff<span class="o">)</span>
</span></span><span class="line"><span class="cl">fffff807<span class="sb">`</span>1e6e7a6c 488d0d0dd46200  lea     rcx,<span class="o">[</span>nt!ObTypeIndexTable <span class="o">(</span>fffff807<span class="sb">`</span>1ed14e80<span class="o">)]</span>
</span></span><span class="line"><span class="cl">fffff807<span class="sb">`</span>1e6e7a73 488b04c1        mov     rax,qword ptr <span class="o">[</span>rcx+rax*8<span class="o">]</span>   <span class="p">;</span> Accessing the pointer to nt!ObTypeIndexTable
</span></span><span class="line"><span class="cl">fffff807<span class="sb">`</span>1e6e7a77 c3              ret
</span></span></code></pre></div><ul>
<li>
<p><strong>ObHeaderCookie</strong> is a security mitigation in Windows kernel to enhance kernel object integrity. This cookie value is randomly generated when system boots up. This makes kernel objects less predictable and prevents the attackers to exploit these structures.</p>
</li>
<li>
<p><strong>ObTypeIndexTable</strong> is an array which keeps track of each entry of <code>_OBJECT_TYPE</code> structure represents which specific type of object i.e. Thread, Process, Files and so on.</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; db nt!ObHeaderCookie L1
</span></span><span class="line"><span class="cl">fffff807<span class="sb">`</span>1ed1472c  bb                                               .   
</span></span></code></pre></div><p><code>(((_OBJECT_HEADER &gt;&gt; 0x8) &amp; 0xff ) ^ (_OBJECT_HEADER-&gt;TypeIndex) ) ^ ((nt!ObHeaderCookie) &amp; 0xff)</code></p>
<h5 id="obgetobjecttype">ObGetObjectType<a href="#obgetobjecttype" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">nt</span><span class="err">!</span><span class="n">ObTypeIndexTable</span><span class="p">[</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span>   <span class="p">(((</span><span class="n">_OBJECT_HEADER</span> <span class="o">&gt;&gt;</span> <span class="mh">0x8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span> <span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">_OBJECT_HEADER</span><span class="o">-&gt;</span><span class="n">TypeIndex</span><span class="p">)</span> <span class="p">)</span> <span class="o">^</span> <span class="p">((</span><span class="n">nt</span><span class="err">!</span><span class="n">ObHeaderCookie</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">))</span> <span class="o">*</span> <span class="mh">0x08</span>
</span></span><span class="line"><span class="cl">   <span class="p">]</span>
</span></span></code></pre></div><p>(((0xffffc509bf28b080 &raquo; 0x08) &amp; 0xff) ^ (0xbb) ^ ((0x0c) &amp; 0xff)) = 0x7</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; ? 0xb0 ^ 0xbb ^ 0x0c
</span></span><span class="line"><span class="cl">Evaluate expression: <span class="nv">7</span> <span class="o">=</span> 00000000<span class="sb">`</span><span class="m">00000007</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; dq nt!ObTypeIndexTable L8
</span></span><span class="line"><span class="cl">fffff807<span class="sb">`</span>1ed14e80  00000000<span class="sb">`</span><span class="m">00000000</span> ffffb000<span class="sb">`</span>adbac000
</span></span><span class="line"><span class="cl">fffff807<span class="sb">`</span>1ed14e90  ffffc509<span class="sb">`</span>b88ab640 ffffc509<span class="sb">`</span>b88ab220
</span></span><span class="line"><span class="cl">fffff807<span class="sb">`</span>1ed14ea0  ffffc509<span class="sb">`</span>b88abbc0 ffffc509<span class="sb">`</span>b88abd20
</span></span><span class="line"><span class="cl">fffff807<span class="sb">`</span>1ed14eb0  ffffc509<span class="sb">`</span>b88ab7a0 ffffc509<span class="sb">`</span>b88ab900
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">0: kd&gt; dq nt!ObTypeIndexTable + <span class="o">(</span>0x8 * 0x7<span class="o">)</span> L1
</span></span><span class="line"><span class="cl">fffff807<span class="sb">`</span>1ed14eb8  ffffc509<span class="sb">`</span>b88ab900
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rs" data-lang="rs"><span class="line"><span class="cl"><span class="mi">0</span>: <span class="nc">kd</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="n">nt</span><span class="o">!</span><span class="no">_OBJECT_TYPE</span><span class="w"> </span><span class="n">ffffc509</span><span class="err">`</span><span class="n">b88ab900</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x000</span><span class="w"> </span><span class="n">TypeList</span><span class="w">         </span>: <span class="nc">_LIST_ENTRY</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mh">0xffffc509</span><span class="err">`</span><span class="n">b88ab900</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0xffffc509</span><span class="err">`</span><span class="n">b88ab900</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x010</span><span class="w"> </span><span class="n">Name</span><span class="w">             </span>: <span class="nc">_UNICODE_STRING</span><span class="w"> </span><span class="s">&#34;Process&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x020</span><span class="w"> </span><span class="n">DefaultObject</span><span class="w">    </span>: <span class="p">(</span><span class="n">null</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x028</span><span class="w"> </span><span class="n">Index</span><span class="w">            </span>: <span class="mh">0x7</span><span class="w"> </span><span class="na">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x02c</span><span class="w"> </span><span class="n">TotalNumberOfObjects</span><span class="w"> </span>: <span class="mh">0x68</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x030</span><span class="w"> </span><span class="n">TotalNumberOfHandles</span><span class="w"> </span>: <span class="mh">0x4e1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x034</span><span class="w"> </span><span class="n">HighWaterNumberOfObjects</span><span class="w"> </span>: <span class="mh">0x6c</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x038</span><span class="w"> </span><span class="n">HighWaterNumberOfHandles</span><span class="w"> </span>: <span class="mh">0x55e</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x040</span><span class="w"> </span><span class="n">TypeInfo</span><span class="w">         </span>: <span class="nc">_OBJECT_TYPE_INITIALIZER</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x0b8</span><span class="w"> </span><span class="n">TypeLock</span><span class="w">         </span>: <span class="nc">_EX_PUSH_LOCK</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x0c0</span><span class="w"> </span><span class="n">Key</span><span class="w">              </span>: <span class="mh">0x636f7250</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x0c8</span><span class="w"> </span><span class="n">CallbackList</span><span class="w">     </span>: <span class="nc">_LIST_ENTRY</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mh">0xffff9901</span><span class="err">`</span><span class="mi">07</span><span class="n">feee00</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">0xffff9901</span><span class="err">`</span><span class="mi">07</span><span class="n">feee00</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></span></span></code></pre></div><p><strong>Pool Header</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; dt nt!_POOL_HEADER ffffc509<span class="sb">`</span>bf28b000
</span></span><span class="line"><span class="cl">   +0x000 PreviousSize     : 0y00000000 <span class="o">(</span>0<span class="o">)</span>
</span></span><span class="line"><span class="cl">   +0x000 PoolIndex        : 0y00000000 <span class="o">(</span>0<span class="o">)</span>
</span></span><span class="line"><span class="cl">   +0x002 BlockSize        : 0y11010000 <span class="o">(</span>0xd0<span class="o">)</span>
</span></span><span class="line"><span class="cl">   +0x002 PoolType         : 0y00000010 <span class="o">(</span>0x2<span class="o">)</span> // NonPagedPoolMustSucceed
</span></span><span class="line"><span class="cl">   +0x000 Ulong1           : 0x2d00000
</span></span><span class="line"><span class="cl">   +0x004 PoolTag          : 0x636f7250
</span></span><span class="line"><span class="cl">   +0x008 ProcessBilled    : <span class="o">(</span>null<span class="o">)</span> 
</span></span><span class="line"><span class="cl">   +0x008 AllocatorBackTraceIndex : <span class="m">0</span>
</span></span><span class="line"><span class="cl">   +0x00a PoolTagHash      : <span class="m">0</span>
</span></span></code></pre></div><ul>
<li>PreviousSize : Size of Previous Chunk / 16</li>
<li>PoolIndex    : Index to an array of PoolDescriptor</li>
<li>BlockSize    : Size of Current Block / 16</li>
<li>PoolType     : Information regarding the allocation tyoe</li>
<li>ProcessBilled: Pointer to _EPROCESS, which made this allocation. Only exists if PoolType is PoolQuota.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; dt nt!_POOL_TYPE
</span></span><span class="line"><span class="cl">   <span class="nv">NonPagedPool</span> <span class="o">=</span> 0n0
</span></span><span class="line"><span class="cl">   <span class="nv">NonPagedPoolExecute</span> <span class="o">=</span> 0n0
</span></span><span class="line"><span class="cl">   <span class="nv">PagedPool</span> <span class="o">=</span> 0n1
</span></span><span class="line"><span class="cl">   <span class="nv">NonPagedPoolMustSucceed</span> <span class="o">=</span> 0n2
</span></span><span class="line"><span class="cl">   <span class="nv">DontUseThisType</span> <span class="o">=</span> 0n3
</span></span><span class="line"><span class="cl">   <span class="nv">NonPagedPoolCacheAligned</span> <span class="o">=</span> 0n4
</span></span><span class="line"><span class="cl">   <span class="nv">PagedPoolCacheAligned</span> <span class="o">=</span> 0n5
</span></span><span class="line"><span class="cl">   <span class="nv">NonPagedPoolCacheAlignedMustS</span> <span class="o">=</span> 0n6
</span></span><span class="line"><span class="cl">   <span class="nv">MaxPoolType</span> <span class="o">=</span> 0n7
</span></span><span class="line"><span class="cl">   <span class="nv">NonPagedPoolBase</span> <span class="o">=</span> 0n0
</span></span><span class="line"><span class="cl">   <span class="nv">NonPagedPoolBaseMustSucceed</span> <span class="o">=</span> 0n2
</span></span><span class="line"><span class="cl">   <span class="nv">NonPagedPoolBaseCacheAligned</span> <span class="o">=</span> 0n4
</span></span><span class="line"><span class="cl">   <span class="nv">NonPagedPoolBaseCacheAlignedMustS</span> <span class="o">=</span> 0n6
</span></span><span class="line"><span class="cl">   <span class="nv">NonPagedPoolSession</span> <span class="o">=</span> 0n32
</span></span><span class="line"><span class="cl">   <span class="nv">PagedPoolSession</span> <span class="o">=</span> 0n33
</span></span><span class="line"><span class="cl">   <span class="nv">NonPagedPoolMustSucceedSession</span> <span class="o">=</span> 0n34
</span></span><span class="line"><span class="cl">   <span class="nv">DontUseThisTypeSession</span> <span class="o">=</span> 0n35
</span></span><span class="line"><span class="cl">   <span class="nv">NonPagedPoolCacheAlignedSession</span> <span class="o">=</span> 0n36
</span></span><span class="line"><span class="cl">   <span class="nv">PagedPoolCacheAlignedSession</span> <span class="o">=</span> 0n37
</span></span><span class="line"><span class="cl">   <span class="nv">NonPagedPoolCacheAlignedMustSSession</span> <span class="o">=</span> 0n38
</span></span><span class="line"><span class="cl">   <span class="nv">NonPagedPoolNx</span> <span class="o">=</span> 0n512
</span></span><span class="line"><span class="cl">   <span class="nv">NonPagedPoolNxCacheAligned</span> <span class="o">=</span> 0n516
</span></span><span class="line"><span class="cl">   <span class="nv">NonPagedPoolSessionNx</span> <span class="o">=</span> 0n544
</span></span></code></pre></div><p>Lets check it for some other process</p>
<h4 id="inspecting-notepadexe">Inspecting Notepad.exe<a href="#inspecting-notepadexe" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; !process <span class="m">0</span> <span class="m">0</span> notepad.exe
</span></span><span class="line"><span class="cl">PROCESS ffffc509c222c340
</span></span><span class="line"><span class="cl">    SessionId: <span class="m">1</span>  Cid: 05a8    Peb: 74d112d000  ParentCid: <span class="m">1148</span>
</span></span><span class="line"><span class="cl">    DirBase: 41f4c002  ObjectTable: ffff990111c26780  HandleCount: 482.
</span></span><span class="line"><span class="cl">    Image: notepad.exe
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">0: kd&gt; !object ffffc509c222c340
</span></span><span class="line"><span class="cl">Object: ffffc509c222c340  Type: <span class="o">(</span>ffffc509b88ab900<span class="o">)</span> Process
</span></span><span class="line"><span class="cl">    ObjectHeader: ffffc509c222c310 <span class="o">(</span>new version<span class="o">)</span>
</span></span><span class="line"><span class="cl">    HandleCount: <span class="m">6</span>  PointerCount: <span class="m">195153</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">0: kd&gt; db ffffc509c222c340-90
</span></span><span class="line"><span class="cl">ffffc509<span class="sb">`</span>c222c2b0  <span class="m">00</span> 6f d0 <span class="m">02</span> <span class="m">50</span> <span class="m">72</span> 6f 63-c8 <span class="m">14</span> c1 c1 <span class="m">09</span> c5 ff ff  .o..Proc........
</span></span><span class="line"><span class="cl">ffffc509<span class="sb">`</span>c222c2c0  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> 00-a8 0c <span class="m">10</span> <span class="m">00</span> <span class="m">03</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  ................
</span></span><span class="line"><span class="cl">ffffc509<span class="sb">`</span>c222c2d0  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> 00-50 <span class="m">00</span> e3 c0 <span class="m">09</span> c5 ff ff  ........P.......
</span></span><span class="line"><span class="cl">ffffc509<span class="sb">`</span>c222c2e0  <span class="m">00</span> <span class="m">00</span> <span class="m">46</span> <span class="m">09</span> <span class="m">01</span> <span class="m">99</span> ff ff-00 f0 <span class="m">18</span> <span class="m">00</span> <span class="m">30</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  ..F.........0...
</span></span><span class="line"><span class="cl">ffffc509<span class="sb">`</span>c222c2f0  <span class="m">00</span> <span class="m">10</span> <span class="m">00</span> <span class="m">00</span> <span class="m">48</span> 0c <span class="m">00</span> 00-78 <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  ....H...x.......
</span></span><span class="line"><span class="cl">ffffc509<span class="sb">`</span>c222c300  c0 6c e8 ba <span class="m">09</span> c5 ff ff-95 <span class="m">61</span> <span class="m">07</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  .l.......a......
</span></span><span class="line"><span class="cl">ffffc509<span class="sb">`</span>c222c310  <span class="m">51</span> fa <span class="m">02</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> 00-06 <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  Q...............
</span></span><span class="line"><span class="cl">ffffc509<span class="sb">`</span>c222c320  <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> 00-7f <span class="m">00</span> <span class="m">88</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span> <span class="m">00</span>  ................
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">0: kd&gt; dt nt!_OBJECT_HEADER ffffc509c222c340-30
</span></span><span class="line"><span class="cl">   +0x000 PointerCount     : 0n195153
</span></span><span class="line"><span class="cl">   +0x008 HandleCount      : 0n6
</span></span><span class="line"><span class="cl">   +0x008 NextToFree       : 0x00000000<span class="sb">`</span><span class="m">00000006</span> Void
</span></span><span class="line"><span class="cl">   +0x010 Lock             : _EX_PUSH_LOCK
</span></span><span class="line"><span class="cl">   +0x018 TypeIndex        : 0x7f <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">   +0x019 TraceFlags       : <span class="m">0</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">   +0x019 DbgRefTrace      : 0y0
</span></span><span class="line"><span class="cl">   +0x019 DbgTracePermanent : 0y0
</span></span><span class="line"><span class="cl">   +0x01a InfoMask         : 0x88 <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">   +0x01b Flags            : <span class="m">0</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">   +0x01b NewObject        : 0y0
</span></span><span class="line"><span class="cl">   +0x01b KernelObject     : 0y0
</span></span><span class="line"><span class="cl">   +0x01b KernelOnlyAccess : 0y0
</span></span><span class="line"><span class="cl">   +0x01b ExclusiveObject  : 0y0
</span></span><span class="line"><span class="cl">   +0x01b PermanentObject  : 0y0
</span></span><span class="line"><span class="cl">   +0x01b DefaultSecurityQuota : 0y0
</span></span><span class="line"><span class="cl">   +0x01b SingleHandleEntry : 0y0
</span></span><span class="line"><span class="cl">   +0x01b DeletedInline    : 0y0
</span></span><span class="line"><span class="cl">   +0x01c Reserved         : <span class="m">0</span>
</span></span><span class="line"><span class="cl">   +0x020 ObjectCreateInfo : 0xffffc509<span class="sb">`</span>bae86cc0 _OBJECT_CREATE_INFORMATION
</span></span><span class="line"><span class="cl">   +0x020 QuotaBlockCharged : 0xffffc509<span class="sb">`</span>bae86cc0 Void
</span></span><span class="line"><span class="cl">   +0x028 SecurityDescriptor : 0xffff9901<span class="sb">`</span>11fa9365 Void
</span></span><span class="line"><span class="cl">   +0x030 Body             : _QUAD
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">0: kd&gt; db nt!ObHeaderCookie L1
</span></span><span class="line"><span class="cl">fffff807<span class="sb">`</span>1ed1472c  bb                                               .
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">0: kd&gt; ? <span class="o">(</span>0xbb ^ 0x7f ^ c3<span class="o">)</span>
</span></span><span class="line"><span class="cl">Evaluate expression: <span class="nv">7</span> <span class="o">=</span> 00000000<span class="sb">`</span><span class="m">00000007</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">0: kd&gt; ? nt!ObTypeIndexTable + <span class="o">(</span> 0x7 * @<span class="nv">$ptrsize</span> <span class="o">)</span>
</span></span><span class="line"><span class="cl">Evaluate expression: -8765511217480 <span class="o">=</span> fffff807<span class="sb">`</span>1ed14eb8
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">0: kd&gt; dq fffff807<span class="sb">`</span>1ed14eb8 L1
</span></span><span class="line"><span class="cl">fffff807<span class="sb">`</span>1ed14eb8  ffffc509<span class="sb">`</span>b88ab900
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">0: kd&gt; dt nt!_OBJECT_TYPE ffffc509<span class="sb">`</span>b88ab900
</span></span><span class="line"><span class="cl">   +0x000 TypeList         : _LIST_ENTRY <span class="o">[</span> 0xffffc509<span class="sb">`</span>b88ab900 - 0xffffc509<span class="sb">`</span>b88ab900 <span class="o">]</span>
</span></span><span class="line"><span class="cl">   +0x010 Name             : _UNICODE_STRING <span class="s2">&#34;Process&#34;</span>
</span></span><span class="line"><span class="cl">   +0x020 DefaultObject    : <span class="o">(</span>null<span class="o">)</span> 
</span></span><span class="line"><span class="cl">   +0x028 Index            : 0x7 <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">   +0x02c TotalNumberOfObjects : 0x68
</span></span><span class="line"><span class="cl">   +0x030 TotalNumberOfHandles : 0x4e1
</span></span><span class="line"><span class="cl">   +0x034 HighWaterNumberOfObjects : 0x6c
</span></span><span class="line"><span class="cl">   +0x038 HighWaterNumberOfHandles : 0x55e
</span></span><span class="line"><span class="cl">   +0x040 TypeInfo         : _OBJECT_TYPE_INITIALIZER
</span></span><span class="line"><span class="cl">   +0x0b8 TypeLock         : _EX_PUSH_LOCK
</span></span><span class="line"><span class="cl">   +0x0c0 Key              : 0x636f7250
</span></span><span class="line"><span class="cl">   +0x0c8 CallbackList     : _LIST_ENTRY <span class="o">[</span> 0xffff9901<span class="sb">`</span>07feee00 - 0xffff9901<span class="sb">`</span>07feee00 <span class="o">]</span>
</span></span></code></pre></div><h4 id="inspecting-csrssexe">Inspecting csrss.exe<a href="#inspecting-csrssexe" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">0: kd&gt; !process csrss.exe
</span></span><span class="line"><span class="cl">PROCESS ffff938cd7e86080
</span></span><span class="line"><span class="cl">    SessionId: none  Cid: <span class="m">0004</span>    Peb: <span class="m">00000000</span>  ParentCid: <span class="m">0000</span>
</span></span><span class="line"><span class="cl">    DirBase: 001aa000  ObjectTable: ffffc705c3015080  HandleCount: 2197.
</span></span><span class="line"><span class="cl">    Image: System
</span></span><span class="line"><span class="cl">    VadRoot ffff938cd7ea5560 Vads <span class="m">6</span> Clone <span class="m">0</span> Private 21. Modified 10228. Locked 0.
</span></span><span class="line"><span class="cl">    DeviceMap ffffc705c304a540
</span></span><span class="line"><span class="cl">....
</span></span><span class="line"><span class="cl">....
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">0: kd&gt; !pool ffff938cd7e86010
</span></span><span class="line"><span class="cl">Pool page ffff938cd7e86010 region is Nonpaged pool
</span></span><span class="line"><span class="cl"> ffff938cd7e86010 size:  e00 previous size:    <span class="m">0</span>  <span class="o">(</span>Allocated<span class="o">)</span>  Proc
</span></span><span class="line"><span class="cl"> ffff938cd7e86e10 size:  1f0 previous size:    <span class="m">0</span>  <span class="o">(</span>Free<span class="o">)</span>       ..<span class="o">[</span>U
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">0: kd&gt; dt nt!_POOL_HEADER ffff938cd7e86080-70
</span></span><span class="line"><span class="cl">   +0x000 PreviousSize     : 0y00000000 <span class="o">(</span>0<span class="o">)</span>
</span></span><span class="line"><span class="cl">   +0x000 PoolIndex        : 0y11111111 <span class="o">(</span>0xff<span class="o">)</span>
</span></span><span class="line"><span class="cl">   +0x002 BlockSize        : 0y11100000 <span class="o">(</span>0xe0<span class="o">)</span>
</span></span><span class="line"><span class="cl">   +0x002 PoolType         : 0y00000010 <span class="o">(</span>0x2<span class="o">)</span>
</span></span><span class="line"><span class="cl">   +0x000 Ulong1           : 0x2e0ff00
</span></span><span class="line"><span class="cl">   +0x004 PoolTag          : 0x636f7250
</span></span><span class="line"><span class="cl">   +0x008 ProcessBilled    : 0xffff938c<span class="sb">`</span>d7e4e9f8 _EPROCESS
</span></span><span class="line"><span class="cl">   +0x008 AllocatorBackTraceIndex : 0xe9f8
</span></span><span class="line"><span class="cl">   +0x00a PoolTagHash      : 0xd7e4
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-rs" data-lang="rs"><span class="line"><span class="cl"><span class="mi">0</span>: <span class="nc">kd</span><span class="o">&gt;</span><span class="w"> </span><span class="o">!</span><span class="n">object</span><span class="w"> </span><span class="n">ffff938cd7e86080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">Object</span>: <span class="nc">ffff938cd7e86080</span><span class="w">  </span><span class="n">Type</span>: <span class="p">(</span><span class="n">ffff938cd7eabbc0</span><span class="p">)</span><span class="w"> </span><span class="n">Process</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">ObjectHeader</span>: <span class="nc">ffff938cd7e86050</span><span class="w"> </span><span class="p">(</span><span class="n">new</span><span class="w"> </span><span class="n">version</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">HandleCount</span>: <span class="mi">4</span><span class="w">  </span><span class="n">PointerCount</span>: <span class="mi">131200</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="mi">0</span>: <span class="nc">kd</span><span class="o">&gt;</span><span class="w"> </span><span class="n">dt</span><span class="w"> </span><span class="n">nt</span><span class="o">!</span><span class="no">_OBJECT_HEADER</span><span class="w"> </span><span class="n">ffff938cd7e86080</span><span class="o">-</span><span class="mi">30</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x000</span><span class="w"> </span><span class="n">PointerCount</span><span class="w">     </span>: <span class="mi">0</span><span class="n">n131200</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x008</span><span class="w"> </span><span class="n">HandleCount</span><span class="w">      </span>: <span class="mi">0</span><span class="n">n4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x008</span><span class="w"> </span><span class="n">NextToFree</span><span class="w">       </span>: <span class="mh">0x00000000</span><span class="err">`</span><span class="mi">00000004</span><span class="w"> </span><span class="n">Void</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x010</span><span class="w"> </span><span class="n">Lock</span><span class="w">             </span>: <span class="nc">_EX_PUSH_LOCK</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x018</span><span class="w"> </span><span class="n">TypeIndex</span><span class="w">        </span>: <span class="mh">0x7c</span><span class="w"> </span><span class="sc">&#39;|&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x019</span><span class="w"> </span><span class="n">TraceFlags</span><span class="w">       </span>: <span class="mi">0</span><span class="w"> </span><span class="na">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x019</span><span class="w"> </span><span class="n">DbgRefTrace</span><span class="w">      </span>: <span class="mi">0</span><span class="n">y0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x019</span><span class="w"> </span><span class="n">DbgTracePermanent</span><span class="w"> </span>: <span class="mi">0</span><span class="n">y0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01a</span><span class="w"> </span><span class="n">InfoMask</span><span class="w">         </span>: <span class="mh">0x80</span><span class="w"> </span><span class="na">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">Flags</span><span class="w">            </span>: <span class="mh">0x2</span><span class="w"> </span><span class="na">&#39;&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">NewObject</span><span class="w">        </span>: <span class="mi">0</span><span class="n">y0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">KernelObject</span><span class="w">     </span>: <span class="mi">0</span><span class="n">y1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">KernelOnlyAccess</span><span class="w"> </span>: <span class="mi">0</span><span class="n">y0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">ExclusiveObject</span><span class="w">  </span>: <span class="mi">0</span><span class="n">y0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">PermanentObject</span><span class="w">  </span>: <span class="mi">0</span><span class="n">y0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">DefaultSecurityQuota</span><span class="w"> </span>: <span class="mi">0</span><span class="n">y0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">SingleHandleEntry</span><span class="w"> </span>: <span class="mi">0</span><span class="n">y0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01b</span><span class="w"> </span><span class="n">DeletedInline</span><span class="w">    </span>: <span class="mi">0</span><span class="n">y0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x01c</span><span class="w"> </span><span class="n">Reserved</span><span class="w">         </span>: <span class="mh">0xff938cd7</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x020</span><span class="w"> </span><span class="n">ObjectCreateInfo</span><span class="w"> </span>: <span class="mh">0xfffff806</span><span class="err">`</span><span class="mi">7</span><span class="n">fe66a40</span><span class="w"> </span><span class="no">_OBJECT_CREATE_INFORMATION</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x020</span><span class="w"> </span><span class="n">QuotaBlockCharged</span><span class="w"> </span>: <span class="mh">0xfffff806</span><span class="err">`</span><span class="mi">7</span><span class="n">fe66a40</span><span class="w"> </span><span class="n">Void</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x028</span><span class="w"> </span><span class="n">SecurityDescriptor</span><span class="w"> </span>: <span class="mh">0xffffc705</span><span class="err">`</span><span class="n">c30156a8</span><span class="w"> </span><span class="n">Void</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="o">+</span><span class="mh">0x030</span><span class="w"> </span><span class="n">Body</span><span class="w">             </span>: <span class="nc">_QUAD</span><span class="w">
</span></span></span></code></pre></div><p>InfoMask : 0x80 -&gt; <code>_OBJECT_HEADER_PADDING_INFO</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="mi">0</span><span class="p">:</span> <span class="n">kd</span><span class="o">&gt;</span> <span class="n">dt</span> <span class="n">nt</span><span class="err">!</span><span class="n">_OBJECT_HEADER_PADDING_INFO</span>
</span></span><span class="line"><span class="cl">   <span class="o">+</span><span class="mh">0x000</span> <span class="n">PaddingAmount</span>    <span class="p">:</span> <span class="n">Uint4B</span>
</span></span></code></pre></div><ul>
<li>There is one more way to find the offset</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; db ObpInfoMaskToOffset + <span class="m">80</span> L1
</span></span><span class="line"><span class="cl">fffff806<span class="sb">`</span>7fe39020  <span class="m">04</span>
</span></span></code></pre></div><ul>
<li>Subtract <code>04</code> from the Header Offset</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0: kd&gt; dt nt!_OBJECT_HEADER_PADDING_INFO ffff938cd7e86080-30-4
</span></span><span class="line"><span class="cl">   +0x000 PaddingAmount    : 0x30
</span></span></code></pre></div><p><img src="image-1.png" alt="alt text"></p>
<p><strong>References</strong></p>
<ul>
<li>
<p><a href="https://www.geoffchappell.com/studies/windows/km/ntoskrnl/inc/ntos/ob/object_header/index.htm">https://www.geoffchappell.com/studies/windows/km/ntoskrnl/inc/ntos/ob/object_header/index.htm</a></p>
</li>
<li>
<p><a href="https://ntamonsec.blogspot.com/2020/05/journey-into-object-manager-executive.html">https://ntamonsec.blogspot.com/2020/05/journey-into-object-manager-executive.html</a></p>
</li>
<li>
<p><a href="https://codemachine.com/article_objectheader.html">https://codemachine.com/article_objectheader.html</a></p>
</li>
<li>
<p><a href="https://www.amazon.in/Art-Memory-Forensics-Detecting-Malware/dp/1118825098">The-Art-of-Memory-Forensics</a></p>
</li>
</ul>

      </div></div>

  
    
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h"></span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        <span class="button previous">
            <a href="http://localhost:1313/posts/windows-bigpools/windows-bigpools/">
                <span class="button__icon">←</span>
                <span class="button__text">Windows Bigpools</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="http://localhost:1313/posts/application-crash-dump/">
                <span class="button__text">Application Crash Dump Analysis</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2025 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/mirus-ua/hugo-theme-re-terminal" target="_blank">Theme</a> made by <a href="https://github.com/mirus-ua" target="_blank">Mirus</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>








  
</div>

</body>
</html>
