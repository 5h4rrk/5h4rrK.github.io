<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  
    <title>ReAL-File-System-bi0sCTF2024 :: 5h4rrk </title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Full detailed writeup for ReAL-File-System which is centered around ReFS Log Analysis.
tl;dr
Disk Forensics Resilient File System Log Analysis " />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="http://localhost:1313/posts/resilient-file-system/" />







  
  
  
  
  
  <link rel="stylesheet" href="http://localhost:1313/styles.css">







  <link rel="shortcut icon" href="http://localhost:1313/img/theme-colors/orange.png">
  <link rel="apple-touch-icon" href="http://localhost:1313/img/theme-colors/orange.png">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="ReAL-File-System-bi0sCTF2024">
<meta property="og:description" content="Full detailed writeup for ReAL-File-System which is centered around ReFS Log Analysis.
tl;dr
Disk Forensics Resilient File System Log Analysis " />
<meta property="og:url" content="http://localhost:1313/posts/resilient-file-system/" />
<meta property="og:site_name" content="5h4rrk " />

  
    <meta property="og:image" content="http://localhost:1313/img/favicon/orange.png">
  

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">

  <meta property="article:section" content="Forensics" />


  <meta property="article:published_time" content="2024-03-08 07:51:58 &#43;0000 UTC" />













  


</head>
<body class="orange">




<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/posts">
  <div class="logo">
    shark.exe [0]
  </div>
</a>

    </div>
    
      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">
      
        
          <li><a href="/tags">Tags</a></li>
        
      
      
    </ul>
  </li>
</ul>

    
    
  </div>
  
    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">
    
      
        
          <li><a href="/tags" >Tags</a></li>
        
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="http://localhost:1313/posts/resilient-file-system/">ReAL-File-System-bi0sCTF2024</a>
  </h1>
  <div class="post-meta"><time class="post-date">2024-03-08</time><span class="post-author">5h4rrk</span>
    
</div>

  
    <span class="post-tags">
      
      #<a href="http://localhost:1313/tags/bi0sctf2024/">bi0sCTF2024</a>&nbsp;
      
      #<a href="http://localhost:1313/tags/resilient-file-system/">Resilient File System</a>&nbsp;
      
      #<a href="http://localhost:1313/tags/file-system-analysis/">File System Analysis</a>&nbsp;
      
      #<a href="http://localhost:1313/tags/log-analysis/">Log Analysis</a>&nbsp;
      
      #<a href="http://localhost:1313/tags/file-system-forensics/">File System Forensics</a>&nbsp;
      
      #<a href="http://localhost:1313/tags/refs/">ReFS</a>&nbsp;
      
    </span>
  
  



  

  <div class="post-content"><div>
        <p>Full detailed writeup for ReAL-File-System which is centered around ReFS Log Analysis.</p>
<p><strong>tl;dr</strong></p>
<ul>
<li>Disk Forensics</li>
<li>Resilient File System</li>
<li>Log Analysis</li>
</ul>
<p><strong>Challenge Points</strong>: 1000
<strong>No. of solves</strong>: 0
<strong>Challenge Author</strong>: <a href="https://twitter.com/5h4rrK">5h4rrK</a></p>
<h3 id="challenge-description">Challenge Description<a href="#challenge-description" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>In a desperate bid to synchronize my PC clock, I unwittingly downloaded an application that promised a quick fix but instead wrought havoc by encrypting all my important files. Turning to my DFIR friend for help, his attempts to decipher the encrypted mess only worsened the situation, leaving the filesystem corrupted. My friend told me that only a DFIR expert can help recover my files. I&rsquo;m filled with hope for their assistance in fixing my computer catastrophe.</p>
<details>
<h4 id="question-1"><strong>Question 1</strong><a href="#question-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><strong>List all directories that have been renamed, including their original names and the timestamps of when they were renamed.</strong></p>
<blockquote>
<p>TimeZone - UTC(+05:30) [YYYY-MM-DD HH:MM:SS.XX]
Format - [ [&lsquo;OriginalDirName&rsquo;, &lsquo;RenamedDirName&rsquo;, &lsquo;TimeStamp&rsquo;] , .. ]</p></blockquote>
<h4 id="question-2"><strong>Question 2</strong><a href="#question-2" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><strong>Name all the deleted directories with deletion timestamps.</strong></p>
<blockquote>
<p>TimeZone : UTC(+05:30) [YYYY-MM-DD HH:MM:SS.XX]
Format - [ [&lsquo;DirectoryName&rsquo; , &lsquo;TimeStamp&rsquo;] , .. ]</p></blockquote>
<h4 id="question-3"><strong>Question 3</strong><a href="#question-3" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><strong>List all directories with their creation times, including originals if any that have been renamed or deleted.</strong></p>
<blockquote>
<p>TimeZone : UTC(+05:30) [YYYY-MM-DD HH:MM:SS.XX]
Format - [ [&lsquo;DirectoryName&rsquo; , &lsquo;CreatedTime&rsquo;] , &hellip;. ]</p></blockquote>
<h4 id="question-4"><strong>Question 4</strong><a href="#question-4" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><strong>Recover the files that have been deleted, and provide the md5sum of each recovered file.</strong></p>
<blockquote>
<p>Format - [ [&lsquo;file1hash&rsquo;] , [&lsquo;file2hash&rsquo;], &hellip; ]</p></blockquote>
<h4 id="question-5"><strong>Question 5</strong><a href="#question-5" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><strong>Identify all files that have been deleted (Simple + Permanent), including their deletion timestamps.</strong></p>
<blockquote>
<p>TimeZone : UTC(+05:30) [YYYY-MM-DD HH:MM:SS.XX]
Format - [ [ &lsquo;filename&rsquo; , &lsquo;TimeStamp&rsquo; , &lsquo;Simple/Permanent&rsquo; ] , .. ]</p></blockquote>
<h4 id="question-6"><strong>Question 6</strong><a href="#question-6" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><strong>Restore all encrypted files, decrypt them, and provide the md5sum of each decrypted file after removing any extra bytes before computing the hash.</strong></p>
<blockquote>
<p>Format - [ [&lsquo;hash1&rsquo;] , [&lsquo;hash2&rsquo;], &lsquo;,..]</p></blockquote>
</details>
<h1 id="solution">Solution<a href="#solution" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p>To address the corruption in the file system, we&rsquo;ll initiate the repair process by examining the file system using a Hex Editor. Since the Resilient File System (ReFS) is not widely supported by forensic tools, we&rsquo;ll rely on <a href="/posts/resilient-file-system/#References">research papers</a> for its structures.</p>
<p>The most recent version of Active Disk Editor is capable of loading ReFS, so we can load the image and confirm its integrity.</p>
<h2 id="overview-of-refs-structure">Overview of ReFS structure<a href="#overview-of-refs-structure" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p><img src="/posts/resilient-file-system/images/image-104.png" alt="AltText"></p>
<p>The Volume Boot Record (VBR) serves as a reference to the <code>Superblock</code>, a crucial component. The <code>Superblock</code> references to child nodes known as <code>CheckPoint</code>.</p>
<p><img src="/posts/resilient-file-system/images/image-106.png" alt="AltText"></p>
<p><img src="/posts/resilient-file-system/images/image-109.png" alt="AltText"></p>
<p>Our initial step would be calculating the cluster size. Later on we need this for carving out the files</p>
<p>Cluster Size = <code>BytesPerSector * SectorsPerCluster</code></p>
<p>ClusterSize = 0x08 * 0x200  = <code>0x1000 (4KB)</code></p>
<h3 id="superblock">SuperBlock<a href="#superblock" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p><img src="/posts/resilient-file-system/images/image-500.png" alt="alt text"></p>
<ul>
<li>
<p>The file system includes three SuperBlocks: one at the start and two at the end.</p>
</li>
<li>
<p>Each SuperBlock contains Cluster Numbers that point to primary and secondary Checkpoints.</p>
</li>
<li>
<p>This redundancy enhances system reliability by enabling quick recovery and maintaining data integrity.</p>
</li>
</ul>
<h3 id="checkpoint">CheckPoint<a href="#checkpoint" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p><img src="/posts/resilient-file-system/images/image-501.png" alt="alt text"></p>
<ul>
<li>
<p>The file system has two CheckPoints.</p>
</li>
<li>
<p>Each CheckPoint includes ReFS version information, Entry Size, and Entry Offset relative in position.</p>
</li>
<li>
<p>At offset <code>0xD0</code>, there are 4 bytes representing the number of entries. Reading the next 4 bytes for each entry, we can identify the offsets to entries of the Object Table, Container Table, Directory Tree, and so on.</p>
</li>
<li>
<p>Following these offsets allows us to precisely determine the locations of <code>MSB+</code> standard nodes. It&rsquo;s crucial to note that the signature for standard nodes is absence in ReFS 1.2 version.</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">META_HDR_3FORMAT</span> <span class="o">=</span> <span class="s1">&#39;&lt;4sIQ16s4Q2Q&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">META_HDR_3FILEDS</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;signature&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;fixed_0x2?&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;_unknown_2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;_unknown_3&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;LCN(1)&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;LCN(2)&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;LCN(3)&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;LCN(4)&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;_object_id&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;object_id&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">META_HDR_3SZ</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">calcsize</span><span class="p">(</span><span class="n">META_HDR_3FORMAT</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">FSMetaPage</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">LCN</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">metapage_sz</span> <span class="o">=</span> <span class="mh">0x1000</span>
</span></span><span class="line"><span class="cl">        <span class="n">vol</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">LCN</span> <span class="o">*</span> <span class="n">metapage_sz</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">vol</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">metapage_sz</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">META_HDR_3FILEDS</span><span class="p">,</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">META_HDR_3FORMAT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">buf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">META_HDR_3SZ</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="n">snip</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SuperBlock</span><span class="p">(</span><span class="n">FSMetaPage</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">LCN</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">(</span><span class="n">SuperBlock</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">vol</span><span class="p">,</span> <span class="n">LCN</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="n">snip</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CheckPoint</span><span class="p">(</span><span class="n">FSMetaPage</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vol</span><span class="p">,</span> <span class="n">LCN</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">(</span><span class="n">CheckPoint</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">vol</span><span class="p">,</span> <span class="n">LCN</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="n">snip</span><span class="p">]</span>
</span></span></code></pre></div><p><em>Source : <a href="https://github.com/horensic/ARIN">ARIN</a></em></p>
<p>The <code>SuperBlock</code> class inherits properties from the <code>FSMetaPage</code> class. The first Logical Cluster Number <strong>LCN(1)</strong>, is a self-referencing offset. This means that it points back to the <code>SuperBlock</code> itself.</p>
<p>Similarly, in the case of the <code>CheckPoint</code>, the first Logical Cluster Number <strong>LCN(1)</strong> also serves as a self-referencing offset .</p>
<p>Upon examination of the filesystem, it becomes evident that the <code>SuperBlock</code> and <code>CheckPoint</code> LCN(1) appears as null. To rectify this issue, we must ensure that the offset of the Superblock and CheckPoint is correctly set.</p>
<ul>
<li>
<p>Offset of the first Superblock = <code>0x1E0000</code></p>
</li>
<li>
<p>LCN1 = <code>0x1E000 / 0x1000 = 0x1E</code> (Little Endian)</p>
</li>
</ul>
<p>Similar calculations and adjustments are necessary for other Superblock and CheckPoint</p>
<ul>
<li>Within the filesystem, there are three SuperBlocks and two Checkpoints. Fixing any one of these SuperBlocks and Checkpoints will resolve the issue at hand.</li>
</ul>
<p><img src="/posts/resilient-file-system/images/image-101.png" alt="AltText"></p>
<ul>
<li>LCN1 : <code>0x1e</code></li>
<li>Offset : 0x1e * 0x1000 = <strong>0x1e000</strong></li>
</ul>
<p><img src="/posts/resilient-file-system/images/image-102.png" alt="AltText"></p>
<ul>
<li>LCN1 : <code>0x0f7ffd</code></li>
</ul>
<p><img src="/posts/resilient-file-system/images/image-103.png" alt="AltText"></p>
<ul>
<li>LCN1 : <code>0x0f7ffe</code></li>
</ul>
<p><img src="image100.png" alt="AltText"></p>
<ul>
<li>LCN1 : <code>0x27d0</code></li>
</ul>
<p><img src="image.png" alt="AltText"></p>
<ul>
<li>LCN1 : <code>0x01dc48</code></li>
</ul>
<p>Now, let&rsquo;s proceed by opening the file system image in Active Disk Editor.</p>
<p><img src="/posts/resilient-file-system/images/image-105.png" alt="AltText"></p>
<h3 id="logfile">LogFile<a href="#logfile" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>A logfile is a metadata file that stores transactional data to facilitate the recovery of the file system to a consistent state in the event of system crashes and unexpected conditions</p>
<ul>
<li>
<p>It contains changes in metadata of files and directories like <code>CREATE</code>, <code>MOVE</code>, <code>RENAME</code> and <code>DELETE</code>.</p>
</li>
<li>
<p>In ReFS, logs are stored in a <code>LogFile</code>. The structure of the <code>LogFile</code> differs significantly from that of NTFS.</p>
</li>
<li>
<p>The opcodes used in ReFS <code>LogFile</code> differ from those found in NTFS&rsquo;s <code>$LogFile</code>.</p>
</li>
<li>
<p>ReFS performs only <code>redo</code> operations, whereas NTFS performs both <code>redo</code> and <code>undo</code> operations.</p>
</li>
<li>
<p>We can locate the LogFile by searching <code>MLog</code>and ignores the first two <code>MLog</code> pages (control log type).</p>
</li>
</ul>
<h3 id="refs-logfile-vs-ntfs-logfile">ReFS LogFile vs NTFS $LogFile<a href="#refs-logfile-vs-ntfs-logfile" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p><img src="/posts/resilient-file-system/images/image-502.png" alt="alt text"></p>
<p><em>Fig : Redo Structure of ReFS</em></p>
<p><img src="/posts/resilient-file-system/images/image-504.png" alt="alt text"></p>
<p><em>Fig : Structure of Operation Record of NTFS $LogFile</em></p>
<p>Read <a href="https://eudl.eu/pdf/10.1007/978-3-642-35515-8_18">Finding Forensic Information on Creating a Folder in $LogFile of NTFS </a></p>
<p>Now, let&rsquo;s explore the structure of the ReFS LogFile in detail.</p>
<h3 id="refs-logfile-structure">ReFS LogFile Structure<a href="#refs-logfile-structure" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p><img src="/posts/resilient-file-system/images/image-201.png" alt="AltText"></p>
<h4 id="explanation">Explanation<a href="#explanation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<h4 id="entry-header-and-log-record-header">Entry Header and Log Record Header<a href="#entry-header-and-log-record-header" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><img src="/posts/resilient-file-system/images/image-204.png" alt="AltText"></p>
<blockquote>
<p>Red Bounded Area -&gt; <code>ReFS Entry Header</code>
Green Bounded Area -&gt; <code>ReFS Log Header</code></p></blockquote>
<h4 id="log-record">Log Record<a href="#log-record" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><img src="/posts/resilient-file-system/images/image-207.png" alt="alt text"></p>
<h4 id="redo-record-header">Redo Record Header<a href="#redo-record-header" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><img src="/posts/resilient-file-system/images/image-208.png" alt="AltText"></p>
<p>Redo Log Header Size : 0x38 bytes</p>
<h4 id="redo-data-offset-array">Redo Data Offset Array<a href="#redo-data-offset-array" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<p><img src="/posts/resilient-file-system/images/image-209.png" alt="AltText"></p>
<p><code>Tail Offset</code> : <em>indicates ending of data offset array</em></p>
<p><code>Tail Size</code>: <em>size of each transaction</em></p>
<h4 id="redo-transactional-data">Redo Transactional Data<a href="#redo-transactional-data" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<h5 id="example-1">Example 1<a href="#example-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<p><img src="/posts/resilient-file-system/images/image-210.png" alt="AltText"></p>
<h5 id="example-2">Example 2<a href="#example-2" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<p><img src="/posts/resilient-file-system/images/image-211.png" alt="AltText"></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">REFS_REDO_REC_HDR_FIELDS</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;redo_rec_size&#39;</span><span class="p">,</span> <span class="s1">&#39;opcode&#39;</span><span class="p">,</span> <span class="s1">&#39;tablekeys_count&#39;</span><span class="p">,</span> <span class="s1">&#39;tablekeys_offset&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;value_count&#39;</span><span class="p">,</span> <span class="s1">&#39;value_offset&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown1&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;unknown2&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown3&#39;</span><span class="p">,</span> <span class="s1">&#39;rec_mark&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;seq_no&#39;</span><span class="p">,</span> <span class="s1">&#39;end_mark&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">TransactionContext</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buf</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_header</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">transaction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse_transaction</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;TransactionContext&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">parse_header</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">REFS_REDO_REC_HDR_FIELDS</span><span class="p">,</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">REFS_REDO_REC_HDR_FORMAT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">buf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">REFS_REDO_REC_HDR_SZ</span><span class="p">))))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">parse_transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">transaction</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="n">tail_offset</span><span class="p">,</span> <span class="n">tail_size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;2I&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">buf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">next_rp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buf</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="p">(</span><span class="kc">True</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">next_rp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">next_rp</span> <span class="o">==</span> <span class="n">tail_offset</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span><span class="line"><span class="cl">            <span class="n">offset</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;&lt;2I&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">buf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="n">next_rp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buf</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">transaction</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">next_rp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">tail_offset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">tail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">tail_size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">transaction</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tail</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">transaction</span>
</span></span></code></pre></div><p><em>Source: <a href="https://github.com/horensic/ARIN">ARIN</a></em></p>
<h5 id="example-3">Example 3<a href="#example-3" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<p><img src="/posts/resilient-file-system/images/image-9.png" alt="alt text"></p>
<h5 id="example-4-control-log-type">Example 4 (Control Log Type)<a href="#example-4-control-log-type" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<p><img src="/posts/resilient-file-system/images/image-505.png" alt="alt text"></p>
<p><em>Fig : Control Log Type</em></p>
<h2 id="answers">Answers<a href="#answers" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<h4 id="extracting-log-files-from-the-file-system">Extracting Log Files from the File System<a href="#extracting-log-files-from-the-file-system" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">dd <span class="k">if</span><span class="o">=</span>ReAL_File_System.001 <span class="nv">skip</span><span class="o">=</span><span class="k">$((</span><span class="m">0</span>x20001000<span class="k">))</span> <span class="nv">count</span><span class="o">=</span><span class="k">$((</span><span class="m">0</span>x200A7000 <span class="o">-</span><span class="m">0</span>x20001000<span class="k">))</span> <span class="nv">of</span><span class="o">=</span>logs.txt <span class="nv">bs</span><span class="o">=</span><span class="m">1</span>
</span></span></code></pre></div><h4 id="question-1-1">Question-1<a href="#question-1-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<ol>
<li>List all directories that have been renamed, including their original names and the timestamps of when they were renamed.</li>
</ol>
<blockquote>
<p><strong>Format :[ [&lsquo;OriginalDirName&rsquo;, &lsquo;RenamedDirName&rsquo;, TimeStamp] , .. ]</strong></p></blockquote>
<p>To identify renamed directories in ReFS, search for the specific opcodes related to directory renaming. By examining consecutive MLog entries associated with these opcodes, we can reveal the timestamps indicating when the renaming occurred.</p>
<p>To locate directories in the LogFile, search for the hexadecimal values <code>30 00 02 00</code>, which serve as prefixes for directory entries. Conversely, the value <code>30 00 01 00</code> typically indicates file entries. However, it&rsquo;s essential to note that there may be some false positives in the search results.</p>
<ul>
<li>File Prefix (from <a href="https://github.com/jamemanionda/ReFS_Detector">ReFS Detector</a>) : <code>30 01 00 00 80 01 00 00 00 00 00 00 30 00 01 00</code></li>
</ul>
<p>Directory Renamed Opcode : <strong><code>0x2 -&gt; 0x2 -&gt; 0x1 -&gt; 0x1 -&gt; 0x4</code></strong></p>
<p><img src="/posts/resilient-file-system/images/image-38.png" alt="AltText"></p>
<p><img src="/posts/resilient-file-system/images/image-39.png" alt="AltText"></p>
<p>Timestamp will be found in next <code>MLog</code> page (starting with opcode <code>0x4</code>).</p>
<p><img src="/posts/resilient-file-system/images/image-55.png" alt="AltText"></p>
<p><img src="/posts/resilient-file-system/images/image-40.png" alt="AltText"></p>
<p>The timestamp in the ReFS LogFile is in Little-Endian format. To convert it to UTC +5:30, we can use <a href="https://www.digital-detective.net/dcode/">DCode</a> tool.</p>
<p><em>[&rsquo;e88e52cac&rsquo;, &lsquo;88077a4a1370&rsquo;, &lsquo;2024-02-18 13:10:20.49&rsquo;]</em></p>
<p>We can write a script to automate the process.</p>
<p><em>[&lsquo;fb828d071&rsquo;, &lsquo;cad090f9724d&rsquo;, &lsquo;2024-02-18 13:12:12.48&rsquo;]</em></p>
<p><strong>Final Ans</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">   <span class="p">[</span> <span class="p">[</span><span class="s1">&#39;e88e52cac&#39;</span><span class="p">,</span> <span class="s1">&#39;88077a4a1370&#39;</span><span class="p">,</span> <span class="s1">&#39;2024-02-18 13:10:20.49&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;fb828d071&#39;</span><span class="p">,</span><span class="s1">&#39;cad090f9724d&#39;</span><span class="p">,</span> <span class="s1">&#39;2024-02-18 13:12:12.48&#39;</span><span class="p">]</span> <span class="p">]</span>
</span></span></code></pre></div><h4 id="question-2-1">Question-2<a href="#question-2-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<ol start="2">
<li>Name all the deleted directories with deletion timestamps.</li>
</ol>
<blockquote>
<p><strong>Format : [ [&lsquo;DirectoryName&rsquo; , &lsquo;TimeStamp&rsquo;] , .. ]</strong></p></blockquote>
<p>Deletions can occur in two ways: Simple and Permanent.</p>
<p>Opcode for Permanent Deletion</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0x2 -&gt; 0xf -&gt; 0x2 -&gt; 0xf -&gt; 0x4 -&gt; 0x12
</span></span></code></pre></div><p><img src="/posts/resilient-file-system/images/image-44.png" alt="AltText"></p>
<p><img src="/posts/resilient-file-system/images/image-41.png" alt="AltText"></p>
<p>To find the remaining opcodes, you can search in the next <code>MLog</code> entries. The timestamp can be found in opcode <code>0x04</code>.</p>
<p><img src="/posts/resilient-file-system/images/image-42.png" alt="AltText">
<img src="/posts/resilient-file-system/images/image-43.png" alt="AltText"></p>
<p><strong>Permanently Deleted Directories</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="p">[</span>
</span></span><span class="line"><span class="cl">     <span class="p">[</span><span class="s1">&#39;f8f1c218f9&#39;</span><span class="p">,</span> <span class="s1">&#39;2024-02-18 13:11:28.57&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">     <span class="p">[</span><span class="s1">&#39;de34f60ab&#39;</span><span class="p">,</span>  <span class="s1">&#39;2024-02-18 13:13:19.60&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p>Simple Deleted Directory Opcode</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">P<span class="o">(</span>Directory Creation<span class="o">)</span> → 0x06 → 0x04 → 0x04 → 0x04 → 0x04 → 0x03 → 0x02 → 0x02 → 0x01 → 0x01 → 0x0e → 0x04 → 0x03 → 0x04 → 0x04 → 0x04 → 0x01 → 0x04 → 0x03 → 0x04 → 0x04 → 0x08
</span></span></code></pre></div><p>After a directory is created, the opcode follows. It&rsquo;s important to note that directories created with names starting with <code>$</code> can be easily distinguished from other directory creations.</p>
<p><img src="/posts/resilient-file-system/images/image-45.png" alt="AltText"></p>
<p><img src="/posts/resilient-file-system/images/image-213.png" alt="AltText"></p>
<p><img src="/posts/resilient-file-system/images/image-50.png" alt="AltText"></p>
<p><img src="/posts/resilient-file-system/images/image-52.png" alt="AltText"></p>
<p><img src="/posts/resilient-file-system/images/image-48.png" alt="AltText"></p>
<p><img src="/posts/resilient-file-system/images/image-46.png" alt="AltText"></p>
<p><img src="/posts/resilient-file-system/images/image-47.png" alt="AltText"></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"> <span class="p">[</span><span class="s1">&#39;c062fb828&#39;</span><span class="p">,</span> <span class="s1">&#39;2024-02-18 13:10:48.62&#39;</span><span class="p">]</span>
</span></span></code></pre></div><p>Alternatively, another method to determine the deletion timestamp is by analyzing <code>$IXXXXX</code> entries.</p>
<p><img src="/posts/resilient-file-system/images/image-214.png" alt="AltText"></p>
<p><img src="/posts/resilient-file-system/images/image-215.png" alt="AltText"></p>
<p><strong>Final Ans</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="p">[</span>
</span></span><span class="line"><span class="cl">     <span class="p">[</span><span class="s1">&#39;f8f1c218f9&#39;</span><span class="p">,</span> <span class="s1">&#39;2024-02-18 13:11:28.57&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">     <span class="p">[</span><span class="s1">&#39;de34f60ab&#39;</span><span class="p">,</span>  <span class="s1">&#39;2024-02-18 13:13:19.60&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">     <span class="p">[</span><span class="s1">&#39;c062fb828&#39;</span><span class="p">,</span>  <span class="s1">&#39;2024-02-18 13:10:48.62&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><h4 id="question--3">Question -3<a href="#question--3" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<hr>
<ol start="3">
<li>List all directories with their creation times, including renamed and deleted.</li>
</ol>
<blockquote>
<p><strong>Note : If a directory was renamed, include its original name and creation time.</strong></p></blockquote>
<blockquote>
<p><strong>Fomat : [ [&lsquo;DirectoryName&rsquo; , &lsquo;CreatedTime&rsquo;] , &hellip;. ]</strong></p></blockquote>
<p>Dir Creation</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0x00 → 0x00 → 0x04 → 0x10 → 0x01 → 0x01 → 0x01 → 0x0e → 0x03 → 0x04
</span></span></code></pre></div><p><img src="/posts/resilient-file-system/images/image-54.png" alt="AltText"></p>
<p><img src="/posts/resilient-file-system/images/image-53.png" alt="AltText"></p>
<p><img src="/posts/resilient-file-system/images/image-56.png" alt="AltText"></p>
<p><strong><em>Final Ans</em></strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">    <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="s1">&#39;de34f60ab&#39;</span><span class="p">,</span> <span class="s1">&#39;2024-02-18 13:06:59.22&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="s1">&#39;e88e52cac&#39;</span><span class="p">,</span> <span class="s1">&#39;2024-02-18 13:07:31.13&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="s1">&#39;fb828d071&#39;</span><span class="p">,</span> <span class="s1">&#39;2024-02-18 13:08:13.88&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="s1">&#39;f8f1c218f9&#39;</span><span class="p">,</span><span class="s1">&#39;2024-02-18 13:08:40.58&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="s1">&#39;c062fb828&#39;</span><span class="p">,</span> <span class="s1">&#39;2024-02-18 13:09:14.55&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="s1">&#39;bb6de6190&#39;</span><span class="p">,</span> <span class="s1">&#39;2024-02-18 13:09:34.00&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span></code></pre></div><h4 id="question---4">Question - 4<a href="#question---4" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<hr>
<ol start="4">
<li>Recover the files that have been deleted, and provide the <strong>md5sum</strong> of each recovered file.</li>
</ol>
<blockquote>
<p><strong>Format : [ [&lsquo;file1hash&rsquo;]&rsquo; , [&lsquo;file2hash2&rsquo;], &hellip; ]</strong></p></blockquote>
<ul>
<li>We can find files that are simply deleted.</li>
</ul>
<p><img src="/posts/resilient-file-system/images/image-57.png" alt="AltText"></p>
<ul>
<li>
<p><code>$IXXXXX</code> file has components like filename, fullpath , deletion time etc.</p>
</li>
<li>
<p><code>$RXXXXX</code> file contents can be recovered.</p>
</li>
</ul>
<p><img src="/posts/resilient-file-system/images/image-59.png" alt="AltText"></p>
<p><img src="/posts/resilient-file-system/images/image-60.png" alt="AltText"></p>
<p><img src="/posts/resilient-file-system/images/image-58.png" alt="AltText"></p>
<ul>
<li>
<p>We can use the <strong>dd</strong> command to extract a file from an image file. We can also increase the extraction speed by adjusting the block size.</p>
</li>
<li>
<p>Divide the skip and count by block-size.</p>
</li>
<li>
<p>Copying and pasting content from Active Disk Editor works for smaller files. However, for larger files, it won&rsquo;t work :)</p>
</li>
</ul>
<h5 id="extracting-deleted-files">Extracting deleted files<a href="#extracting-deleted-files" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">dd <span class="k">if</span><span class="o">=</span>ReAL_File_System.001 <span class="nv">skip</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">0</span>x1000 <span class="o">*</span> <span class="m">71168</span><span class="o">)/</span><span class="m">1</span><span class="k">))</span> <span class="nv">count</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">0</span>x15a<span class="o">)/</span><span class="m">1</span><span class="k">))</span>  <span class="nv">bs</span><span class="o">=</span><span class="m">1</span> <span class="nv">of</span><span class="o">=</span>simple-pass.txt
</span></span><span class="line"><span class="cl">dd <span class="k">if</span><span class="o">=</span>ReAL_File_System.001 <span class="nv">skip</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">0</span>x1000 <span class="o">*</span> <span class="m">68608</span><span class="o">)/</span><span class="m">16</span><span class="k">))</span> <span class="nv">count</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">0</span>x04e20<span class="o">)/</span><span class="m">16</span><span class="k">))</span>  <span class="nv">bs</span><span class="o">=</span><span class="m">16</span> <span class="nv">of</span><span class="o">=</span>19ff211f
</span></span><span class="line"><span class="cl">dd <span class="k">if</span><span class="o">=</span>ReAL_File_System.001 <span class="nv">skip</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">0</span>x1000 <span class="o">*</span> <span class="m">70144</span><span class="k">))</span><span class="o">)</span> <span class="nv">count</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">0</span>x041b7<span class="k">))</span><span class="o">)</span>  <span class="nv">bs</span><span class="o">=</span><span class="m">1</span> <span class="nv">of</span><span class="o">=</span>fe0c329
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="n">f91488b7e00c31793bd7aa98c51896d0</span>  <span class="n">simple</span><span class="o">-</span><span class="k">pass</span><span class="o">.</span><span class="n">txt</span>
</span></span><span class="line"><span class="cl"><span class="mi">4</span><span class="n">c009b045056af8f9bb401c69408d2cf</span>  <span class="mi">19</span><span class="n">ff211f</span>
</span></span><span class="line"><span class="cl"><span class="n">c50c5bcb9e98537e3d63df1bc68a81d0</span>  <span class="n">fe0c329</span>
</span></span></code></pre></div><p><strong><em>Final Ans</em></strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">    <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="s1">&#39;f91488b7e00c31793bd7aa98c51896d0&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="s1">&#39;4c009b045056af8f9bb401c69408d2cf&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="s1">&#39;c50c5bcb9e98537e3d63df1bc68a81d0&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span></code></pre></div><h4 id="question---5">Question - 5<a href="#question---5" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<hr>
<ol start="5">
<li>Identify all files that have been deleted (Simple + Permanent), including their deletion timestamps.</li>
</ol>
<p>   <strong>Format :[ [ &lsquo;filename&rsquo; , &lsquo;TimeStamp&rsquo; , &lsquo;Simple/Permanent&rsquo; ] , .. ]</strong></p>
<p><strong>Simple Deletion</strong>
<img src="/posts/resilient-file-system/images/image-63.png" alt="AltText"></p>
<p><strong>Permanent Deletion</strong>
<img src="/posts/resilient-file-system/images/image-62.png" alt="AltText">
<img src="/posts/resilient-file-system/images/image-61.png" alt="AltText"></p>
<p>simple-pass.txt</p>
<p><img src="/posts/resilient-file-system/images/image-64.png" alt="AltText">
<img src="/posts/resilient-file-system/images/image-66.png" alt="AltText">
<img src="/posts/resilient-file-system/images/image-67.png" alt="AltText"></p>
<p>TimeStamp</p>
<p><img src="/posts/resilient-file-system/images/image-68.png" alt="AltText"></p>
<p><em>2024-02-18 13:15:00.51</em></p>
<p>In the same manner, examine the log file and we will find the other simple deleted files</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="p">[</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="s1">&#39;simple-pass.txt&#39;</span><span class="p">,</span><span class="s1">&#39;2024-02-18 13:15:00.51&#39;</span><span class="p">,</span><span class="s1">&#39;Simple&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="s1">&#39;19ff211f&#39;</span><span class="p">,</span><span class="s1">&#39;2024-02-18 13:14:31.43&#39;</span><span class="p">,</span><span class="s1">&#39;Simple&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">	<span class="p">[</span><span class="s1">&#39;fe0c329&#39;</span><span class="p">,</span><span class="s1">&#39;2024-02-18 13:15:52.49&#39;</span><span class="p">,</span><span class="s1">&#39;Simple&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p><strong>Permanent Deleted File Opcode</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">0x0f -&gt; 0x02 -&gt; 0x0f -&gt; 0x02 -&gt; 0x04
</span></span></code></pre></div><p><img src="/posts/resilient-file-system/images/image-69.png" alt="AltText">
<img src="/posts/resilient-file-system/images/image-70.png" alt="AltText"></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="o">(</span><span class="s1">&#39;ead47cb&#39;</span>,<span class="s1">&#39;2024-02-18 13:19:26.69&#39;</span>,<span class="s1">&#39;Permanent&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span><span class="s1">&#39;essay.txt&#39;</span>,<span class="s1">&#39;2024-02-18 13:18:22.47&#39;</span>,<span class="s1">&#39;Permanent&#39;</span><span class="o">)</span>
</span></span></code></pre></div><p><strong><em>Final Ans</em></strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">    <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="s1">&#39;simple-pass.txt&#39;</span><span class="p">,</span><span class="s1">&#39;2024-02-18 13:15:00.51&#39;</span><span class="p">,</span><span class="s1">&#39;Simple&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="s1">&#39;19ff211f&#39;</span><span class="p">,</span><span class="s1">&#39;2024-02-18 13:14:31.43&#39;</span><span class="p">,</span><span class="s1">&#39;Simple&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="s1">&#39;fe0c329&#39;</span><span class="p">,</span><span class="s1">&#39;2024-02-18 13:15:52.49&#39;</span><span class="p">,</span><span class="s1">&#39;Simple&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="s1">&#39;ead47cb&#39;</span><span class="p">,</span><span class="s1">&#39;2024-02-18 13:19:26.69&#39;</span><span class="p">,</span><span class="s1">&#39;Permanent&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="s1">&#39;essay.txt&#39;</span><span class="p">,</span><span class="s1">&#39;2024-02-18 13:18:22.47&#39;</span><span class="p">,</span><span class="s1">&#39;Permanent&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span></code></pre></div><h4 id="question-6-1">Question-6<a href="#question-6-1" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<ol start="6">
<li>Restore all encrypted files, decrypt them, and provide the <strong>md5sum</strong> of each decrypted file after removing any extra bytes before computing the hash.</li>
</ol>
<blockquote>
<p><strong>Format :[[&lsquo;hash1&rsquo;], [&lsquo;hash2&rsquo;],..]</strong></p></blockquote>
<h5 id="an-overview-on-time_updateexe">An Overview on time_update.exe<a href="#an-overview-on-time_updateexe" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<hr>
<ol>
<li>
<p>Enumerate each directory and rename all files.</p>
</li>
<li>
<p>Generate a random time and convert it to <code>SystemToFileTime</code>. Generate <code>key1</code> and append a 4-byte nonce.</p>
</li>
<li>
<p>Compute the MD5 hash of <code>key1</code> and set it as <code>key2</code>.</p>
</li>
<li>
<p>Rename each file with a random time and encrypt it.</p>
<ul>
<li>Encryption : <code>enc[i] = file[i] ^ key1[i] ^ key2[i]</code>.</li>
</ul>
</li>
<li>
<p>Enumerate all files again and update their names with the <code>.tort</code> extension.</p>
</li>
<li>
<p>Before exiting, restore the system time to its initial state.</p>
</li>
</ol>
<p><img src="/posts/resilient-file-system/images/image-216.png" alt="AltText">
<img src="/posts/resilient-file-system/images/image-217.png" alt="AltText">
<img src="/posts/resilient-file-system/images/image-218.png" alt="AltText">
<img src="/posts/resilient-file-system/images/image-219.png" alt="AltText">
<img src="/posts/resilient-file-system/images/image-220.png" alt="AltText">
<img src="/posts/resilient-file-system/images/image-221.png" alt="AltText">
<img src="/posts/resilient-file-system/images/image-222.png" alt="AltText">
<img src="/posts/resilient-file-system/images/image-223.png" alt="AltText"></p>
<h5 id="file-decryption">File-Decryption<a href="#file-decryption" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<ul>
<li>
<p>The <code>time_update.exe</code> uses two keys <code>key1</code> and hash of <code>key1</code> as key2 to encrypt the files.</p>
</li>
<li>
<p>To locate <code>key1</code>, we need to find the timestamp of the second rename. However, <code>key1</code> includes an additional 4-byte nonce, the value of which is unknown. Therefore, brute force is required to determine the correct <code>key1</code>.</p>
</li>
<li>
<p>By cross-referencing the encrypted files in the logfile, we can identify the original filenames and then brute force the files using their headers to determine the nonce.</p>
</li>
<li>
<p>Some files only have small byte file signatures, resulting in numerous possible nonces. We can validate these nonces by examining the end-of-file signatures and chunks present in the file.</p>
</li>
</ul>
<p>Because it updates the time before encrypting the files, it leaves a trace in the log files that could potentially be used to recover key.</p>
<blockquote>
<p>Opcode for Renamed File : <strong><code>0x02 → 0x05 → 0x01 → 0x04 → 0x04</code></strong></p></blockquote>
<ul>
<li>
<p>Let&rsquo;s manually search for the required information. We&rsquo;ll begin by assigning filenames with the extension <code>tort</code> and then conduct a search within the log file.</p>
</li>
<li>
<p>Specifically, we&rsquo;ll focus on identifying the first operation code (opcode) located at offset <code>0xb0</code>.</p>
</li>
<li>
<p>After locating it, we&rsquo;ll parse the data and examine the previous MLog to find the corresponding filenames.</p>
</li>
</ul>
<p><img src="/posts/resilient-file-system/images/image-600.png" alt="AltText">
<img src="/posts/resilient-file-system/images/image-1.png" alt="AltText">
<img src="/posts/resilient-file-system/images/image-2.png" alt="AltText">
<img src="/posts/resilient-file-system/images/image-3.png" alt="AltText"></p>
<p>First Rename : <em><code>15005-39026.pdf -&gt; bf2f63b3</code></em></p>
<p>Search for the <em><code>bf2f63b3</code></em>.</p>
<p><img src="/posts/resilient-file-system/images/image-5.png" alt="AltText">
<img src="/posts/resilient-file-system/images/image-6.png" alt="AltText">
<img src="/posts/resilient-file-system/images/image-7.png" alt="AltText"></p>
<p>Second Rename : <em><code>bf2f6b3 -&gt; 0cf51fbc</code></em></p>
<blockquote>
<p>The system time is expressed in Coordinated Universal Time (UTC).</p></blockquote>
<p>Rename Time(Encryption Key) : <em><code>2010-02-26 12:38:43.0000000 </code></em></p>
<pre tabindex="0"><code>Enc Key Time : 2010 2 2 26 12 38 43 0
</code></pre><p><img src="/posts/resilient-file-system/images/image-8.png" alt="AltText"></p>
<p>Third Rename : <em><code>0cf51fbc -&gt; 0cf51fbc.tort</code></em></p>
<p>Similarly, locate the timestamps used for encryption on all remaining files, and then proceed to extract those files accordingly.</p>
<p><code>binary-01.gif -&gt; c7982ef6 -&gt; a917438f -&gt; a917438f.tort</code> : <strong>1995 2 2 27 2 11 42 0</strong></p>
<p><code>Everest Vista.webp -&gt; d406327c -&gt; 3a7fab71 -&gt; 3a7fab71.tort </code> : <strong>1990 8 2 28 21 6 35 0</strong></p>
<p><code>Paranormal Phenomenon.docx -&gt; 830c92a3 -&gt; bb292337 -&gt; bb292337.tort</code> : <strong>1993 7 2 16 17 10 46 0</strong></p>
<p><code>so-cappy.jpg -&gt; 141e0f79 -&gt; 24819686 -&gt; 24819686.tort </code> : <strong>2001 4 2 19 8 27 45 0</strong></p>
<p><code>stuffs.rar -&gt; f15ebcd2 -&gt; 7a6c7166 -&gt; 7a6c7166.tort</code> : <strong>2009 11 2 22 17 5 55 0</strong></p>
<p><code>ySq12b0T.mp4 -&gt; 86c66c9c -&gt; 185c65f8 -&gt; 185c65f8.tort</code> : <strong>2007 7 2 28 3 27 33 0</strong></p>
<p><code>vl36hkjkzbh91.png -&gt; 313feb6e -&gt; cc876a3b -&gt; cc876a3b.tort</code> : <strong>1985 3 2 4 16 23 53 0</strong></p>
<hr>
<p><img src="/posts/resilient-file-system/images/image-224.png" alt="AltText"></p>
<h5 id="carving-out-files">Carving Out Files<a href="#carving-out-files" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h5>
<blockquote>
<p>0cf51fbc.tort</p></blockquote>
<p><img src="/posts/resilient-file-system/images/image-20.png" alt="AltText">
<img src="/posts/resilient-file-system/images/image-21.png" alt="AltText">
<img src="/posts/resilient-file-system/images/image-22.png" alt="AltText"></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">dd <span class="k">if</span><span class="o">=</span>ReAL_File_System.001 <span class="nv">skip</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">0</span>x10e94000<span class="o">)/</span><span class="m">4096</span><span class="k">))</span> <span class="nv">count</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">0</span>x16c000<span class="o">)/</span><span class="m">4096</span><span class="k">))</span>  <span class="nv">bs</span><span class="o">=</span><span class="m">4096</span> <span class="nv">of</span><span class="o">=</span>0cf51fbc_1.tort
</span></span><span class="line"><span class="cl">dd <span class="k">if</span><span class="o">=</span>ReAL_File_System.001 <span class="nv">skip</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">0</span>x11001000<span class="o">)/</span><span class="m">4096</span><span class="k">))</span> <span class="nv">count</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">0</span>x141000<span class="o">)/</span><span class="m">4096</span><span class="k">))</span>  <span class="nv">bs</span><span class="o">=</span><span class="m">4096</span> <span class="nv">of</span><span class="o">=</span>0cf51fbc_2.tort
</span></span><span class="line"><span class="cl">cat 0cf51fbc_1.tort 0cf51fbc_2.tort &gt; 0cf51fbc.tort
</span></span></code></pre></div><blockquote>
<p>a917438f.tort</p></blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">dd <span class="k">if</span><span class="o">=</span>ReAL_File_System.001 <span class="nv">skip</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">0</span>x10025000<span class="o">)/</span><span class="m">64</span><span class="k">))</span> <span class="nv">count</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">0</span>x89ce40<span class="o">)/</span><span class="m">64</span><span class="k">))</span>  <span class="nv">bs</span><span class="o">=</span><span class="m">64</span> <span class="nv">of</span><span class="o">=</span>a917438f.tort
</span></span></code></pre></div><p>Remove the extra bytes from the extracted files present due to the block size used during extraction.</p>
<p><img src="/posts/resilient-file-system/images/image-28.png" alt="AltText"></p>
<hr>
<blockquote>
<p>7a6c7166.tort</p></blockquote>
<p><img src="/posts/resilient-file-system/images/image-30.png" alt="AltText">
<img src="/posts/resilient-file-system/images/image-29.png" alt="AltText">
<img src="/posts/resilient-file-system/images/image-32.png" alt="AltText"></p>
<p>Go to offset <code>0x108c2000</code>, <code>0x10c05000</code> &amp; read <code>830 * 0x1000</code> ,<code>130 * 0x1000</code>bytes respectively</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"> dd <span class="k">if</span><span class="o">=</span>ReAL_File_System.001 <span class="nv">skip</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">0</span>x108c2000<span class="o">)/</span><span class="m">8192</span><span class="k">))</span> <span class="nv">count</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">830</span> <span class="o">*</span> <span class="m">0</span>x1000<span class="o">)/</span><span class="m">8192</span><span class="k">))</span>  <span class="nv">bs</span><span class="o">=</span><span class="m">8192</span> <span class="nv">of</span><span class="o">=</span>7a6c7166_1.tort
</span></span><span class="line"><span class="cl"> dd <span class="k">if</span><span class="o">=</span>ReAL_File_System.001 <span class="nv">skip</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">0</span>x10c05000<span class="o">)/</span><span class="m">4096</span><span class="k">))</span> <span class="nv">count</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">130</span> <span class="o">*</span> <span class="m">0</span>x1000<span class="o">)/</span><span class="m">4096</span><span class="k">))</span>  <span class="nv">bs</span><span class="o">=</span><span class="m">4096</span> <span class="nv">of</span><span class="o">=</span>7a6c7166_2.tort
</span></span><span class="line"><span class="cl"> cat 7a6c7166_1.tort 7a6c7166_2.tort &gt; 7a6c7166.tort
</span></span></code></pre></div><hr>
<blockquote>
<p>185c65f8.tort</p></blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">dd <span class="k">if</span><span class="o">=</span>ReAL_File_System.001 <span class="nv">skip</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">68743</span> <span class="o">*</span> <span class="m">0</span>x1000<span class="o">)/</span><span class="m">4096</span><span class="k">))</span> <span class="nv">count</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">525</span> <span class="o">*</span> <span class="m">0</span>x1000<span class="o">)/</span><span class="m">4096</span><span class="k">))</span>  <span class="nv">bs</span><span class="o">=</span><span class="m">4096</span> <span class="nv">of</span><span class="o">=</span>185c65f8.tort
</span></span></code></pre></div><hr>
<blockquote>
<p>24819686.tort</p></blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">dd <span class="k">if</span><span class="o">=</span>ReAL_File_System.001 <span class="nv">skip</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">0</span>x12800000<span class="o">)/</span><span class="m">4096</span><span class="k">))</span> <span class="nv">count</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">0</span>x10000<span class="o">)/</span><span class="m">4096</span><span class="k">))</span>  <span class="nv">bs</span><span class="o">=</span><span class="m">4096</span> <span class="nv">of</span><span class="o">=</span>24819686.tort
</span></span></code></pre></div><hr>
<blockquote>
<p>3a7fab71.tort</p></blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">dd <span class="k">if</span><span class="o">=</span>ReAL_File_System.001 <span class="nv">skip</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">0</span>x10000000<span class="o">)/</span><span class="m">4096</span><span class="k">))</span> <span class="nv">count</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">0</span>x25000<span class="o">)/</span><span class="m">4096</span><span class="k">))</span>  <span class="nv">bs</span><span class="o">=</span><span class="m">4096</span> <span class="nv">of</span><span class="o">=</span>3a7fab71.tort
</span></span></code></pre></div><hr>
<blockquote>
<p>bb292337.tort</p></blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">dd <span class="k">if</span><span class="o">=</span>ReAL_File_System.001 <span class="nv">skip</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">0</span>x13a00000<span class="o">)/</span><span class="m">4096</span><span class="k">))</span> <span class="nv">count</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">0</span>x8000<span class="o">)/</span><span class="m">4096</span><span class="k">))</span>  <span class="nv">bs</span><span class="o">=</span><span class="m">4096</span> <span class="nv">of</span><span class="o">=</span>bb292337.tort
</span></span></code></pre></div><hr>
<blockquote>
<p>cc876a3b.tort</p></blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">dd <span class="k">if</span><span class="o">=</span>ReAL_File_System.001 <span class="nv">skip</span><span class="o">=</span><span class="k">$((</span><span class="o">(</span><span class="m">0</span>x1000 <span class="o">*</span> <span class="m">72705</span><span class="k">))</span><span class="o">)</span> <span class="nv">count</span><span class="o">=</span><span class="k">$((</span><span class="m">0</span>x175f<span class="k">))</span>  <span class="nv">bs</span><span class="o">=</span><span class="m">1</span> <span class="nv">of</span><span class="o">=</span>cc876a3b.tort
</span></span></code></pre></div><p>We can write a script to remove the extra bytes from the extracted files.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">struct</span>
</span></span><span class="line"><span class="cl"><span class="n">file_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0cf51fbc.tort&#39;</span><span class="p">,</span><span class="s1">&#39;a917438f.tort&#39;</span><span class="p">,</span><span class="s1">&#39;7a6c7166.tort&#39;</span><span class="p">,</span><span class="s1">&#39;185c65f8.tort&#39;</span><span class="p">,</span><span class="s1">&#39;24819686.tort&#39;</span><span class="p">,</span><span class="s1">&#39;3a7fab71.tort&#39;</span><span class="p">,</span><span class="s1">&#39;bb292337.tort&#39;</span><span class="p">,</span><span class="s1">&#39;cc876a3b.tort&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">file_names</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">buff</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">sig</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mh">0x04</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">sz</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&#34;&lt;I&#34;</span><span class="p">,</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mh">0x04</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">buff</span> <span class="o">+=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">sz</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">_</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">sig</span> <span class="o">+</span> <span class="n">sz</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;little&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">buff</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="nc">_SYSTEMTIME</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">WORD</span> <span class="n">wYear</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">WORD</span> <span class="n">wMonth</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">WORD</span> <span class="n">wDayOfWeek</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">WORD</span> <span class="n">wDay</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">WORD</span> <span class="n">wHour</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">WORD</span> <span class="n">wMinute</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">WORD</span> <span class="n">wSecond</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">WORD</span> <span class="n">wMilliseconds</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="n">SYSTEMTIME</span><span class="p">,</span> <span class="o">*</span><span class="n">PSYSTEMTIME</span><span class="p">,</span> <span class="o">*</span><span class="n">LPSYSTEMTIME</span><span class="p">;</span>
</span></span></code></pre></div><p>Read about <a href="https://learn.microsoft.com/en-us/windows/win32/api/minwinbase/ns-minwinbase-systemtime">SystemTime</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">BOOL</span> <span class="nf">SystemTimeToFileTime</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="n">in</span><span class="p">]</span>  <span class="k">const</span> <span class="n">SYSTEMTIME</span> <span class="o">*</span><span class="n">lpSystemTime</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="n">out</span><span class="p">]</span> <span class="n">LPFILETIME</span>       <span class="n">lpFileTime</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span></code></pre></div><p>Read about <a href="https://learn.microsoft.com/en-us/windows/win32/api/timezoneapi/nf-timezoneapi-systemtimetofiletime">SystemTimetoFileSystemTime</a></p>
<p>We need to change SystemTime to SystemTimeToFileTime. To do so, write a cpp code &amp; compile it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdint.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;Windows.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#define ROTATE_LEFT(x, n) (((x) &lt;&lt; (n)) | ((x) &gt;&gt; (32-(n))))
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span> <span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">argv</span><span class="p">[]){</span>
</span></span><span class="line"><span class="cl">    <span class="n">SYSTEMTIME</span> <span class="n">st</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">FILETIME</span> <span class="n">ft</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">st</span><span class="p">.</span><span class="n">wYear</span> <span class="o">=</span>  <span class="p">(</span><span class="kt">int16_t</span><span class="p">)</span> <span class="n">stoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="n">st</span><span class="p">.</span><span class="n">wMonth</span> <span class="o">=</span>  <span class="p">(</span><span class="kt">int16_t</span><span class="p">)</span> <span class="n">stoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="n">st</span><span class="p">.</span><span class="n">wDayOfWeek</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int16_t</span><span class="p">)</span><span class="n">stoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="n">st</span><span class="p">.</span><span class="n">wDay</span> <span class="o">=</span>  <span class="p">(</span><span class="kt">int16_t</span><span class="p">)</span> <span class="n">stoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="n">st</span><span class="p">.</span><span class="n">wHour</span> <span class="o">=</span>  <span class="p">(</span><span class="kt">int16_t</span><span class="p">)</span> <span class="n">stoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">5</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="n">st</span><span class="p">.</span><span class="n">wMinute</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int16_t</span><span class="p">)</span> <span class="n">stoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">6</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="n">st</span><span class="p">.</span><span class="n">wSecond</span> <span class="o">=</span>  <span class="p">(</span><span class="kt">int16_t</span><span class="p">)</span> <span class="n">stoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">7</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="n">st</span><span class="p">.</span><span class="n">wMilliseconds</span> <span class="o">=</span>  <span class="p">(</span><span class="kt">int16_t</span><span class="p">)</span> <span class="n">stoi</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">8</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="n">SystemTimeToFileTime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ft</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">ft</span><span class="p">.</span><span class="n">dwLowDateTime</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; : &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">ft</span><span class="p">.</span><span class="n">dwHighDateTime</span><span class="o">&lt;&lt;</span> <span class="s">&#34;:&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int64_t</span> <span class="n">low</span> <span class="o">=</span> <span class="n">ROTATE_LEFT</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ft</span><span class="p">.</span><span class="n">dwLowDateTime</span><span class="p">),</span> <span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int64_t</span> <span class="n">high</span> <span class="o">=</span> <span class="n">ROTATE_LEFT</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ft</span><span class="p">.</span><span class="n">dwHighDateTime</span><span class="p">)</span> <span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">low</span>  <span class="o">&lt;&lt;</span> <span class="s">&#34;:&#34;</span> <span class="o">&lt;&lt;</span>  <span class="n">high</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>Generate all possible 4 bytes nonces wordlist.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">crunch <span class="m">4</span> <span class="m">4</span> <span class="s2">&#34;0123456789abcdef\!#&amp;*%GHIJ-lm+_&#34;</span>  &gt; passwd.txt
</span></span></code></pre></div><p>File Decryption Script</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">MAPPINGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span> <span class="s1">&#39;7&#39;</span><span class="p">,</span> <span class="s1">&#39;8&#39;</span><span class="p">,</span> <span class="s1">&#39;9&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;J&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;l&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Extensions</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">PNG</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x89\x50\x4E\x47\x0D\x0A\x1A\x0A</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">JPG</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\xff\xd8\xff</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">JPG_END</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\xff\xd9</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">WEBP</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;RIFF</span><span class="se">\x08\x4E\x02\x00</span><span class="s2">&#34;</span> <span class="c1">## [4:8] -&gt; file size</span>
</span></span><span class="line"><span class="cl">    <span class="n">RAR</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x52\x61\x72\x21\x1A\x07</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">GIF</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x47\x49\x46\x38\x39\x61</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">MP4</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;ftyp&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ZIP</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x50\x4B\x03\x04\x14\x00\x06\x00</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">PDF</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;%PDF-1.&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">check_header</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">ext</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">dec</span> <span class="o">=</span> <span class="n">Decryptor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">temp_key2</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;png&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">res</span> <span class="o">=</span> <span class="n">dec</span><span class="p">(</span><span class="n">encbuff</span><span class="o">=</span><span class="n">buff</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">Extensions</span><span class="o">.</span><span class="n">PNG</span><span class="p">)],</span> <span class="n">key1</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">key2</span><span class="o">=</span><span class="n">temp_key2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="n">Extensions</span><span class="o">.</span><span class="n">PNG</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;jpg&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">res</span> <span class="o">=</span> <span class="n">dec</span><span class="p">(</span><span class="n">encbuff</span><span class="o">=</span><span class="n">buff</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">Extensions</span><span class="o">.</span><span class="n">JPG</span><span class="p">)],</span> <span class="n">key1</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">key2</span><span class="o">=</span><span class="n">temp_key2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">res</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">Extensions</span><span class="o">.</span><span class="n">JPG</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">res</span> <span class="o">=</span> <span class="n">dec</span><span class="p">(</span><span class="n">encbuff</span><span class="o">=</span><span class="n">buff</span><span class="p">,</span> <span class="n">key1</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">key2</span><span class="o">=</span><span class="n">temp_key2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="n">Extensions</span><span class="o">.</span><span class="n">JPG_END</span> <span class="ow">and</span> <span class="p">(</span><span class="sa">b</span><span class="s1">&#39;EXIF&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">or</span> <span class="sa">b</span><span class="s1">&#39;JFIF&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="p">)):</span> <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;webp&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">res</span> <span class="o">=</span> <span class="n">dec</span><span class="p">(</span><span class="n">encbuff</span><span class="o">=</span><span class="n">buff</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">Extensions</span><span class="o">.</span><span class="n">WEBP</span><span class="p">)],</span> <span class="n">key1</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">key2</span><span class="o">=</span><span class="n">temp_key2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="n">Extensions</span><span class="o">.</span><span class="n">WEBP</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;rar&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">res</span> <span class="o">=</span> <span class="n">dec</span><span class="p">(</span><span class="n">encbuff</span><span class="o">=</span><span class="n">buff</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">Extensions</span><span class="o">.</span><span class="n">RAR</span><span class="p">)],</span> <span class="n">key1</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">key2</span><span class="o">=</span><span class="n">temp_key2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="n">Extensions</span><span class="o">.</span><span class="n">RAR</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span>  <span class="s1">&#39;gif&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">res</span> <span class="o">=</span><span class="n">dec</span><span class="p">(</span><span class="n">encbuff</span><span class="o">=</span><span class="n">buff</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">Extensions</span><span class="o">.</span><span class="n">GIF</span><span class="p">)],</span> <span class="n">key1</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">key2</span><span class="o">=</span><span class="n">temp_key2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="n">Extensions</span><span class="o">.</span><span class="n">GIF</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">ext</span>  <span class="o">==</span> <span class="s1">&#39;zip&#39;</span> <span class="ow">or</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;docx&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">res</span> <span class="o">=</span><span class="n">dec</span><span class="p">(</span><span class="n">encbuff</span><span class="o">=</span><span class="n">buff</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">Extensions</span><span class="o">.</span><span class="n">ZIP</span><span class="p">)],</span> <span class="n">key1</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">key2</span><span class="o">=</span><span class="n">temp_key2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="n">Extensions</span><span class="o">.</span><span class="n">ZIP</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;mp4&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">res</span> <span class="o">=</span><span class="n">dec</span><span class="p">(</span><span class="n">encbuff</span><span class="o">=</span><span class="n">buff</span><span class="p">[:</span><span class="mi">32</span><span class="p">],</span> <span class="n">key1</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">key2</span><span class="o">=</span><span class="n">temp_key2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">res</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="n">Extensions</span><span class="o">.</span><span class="n">MP4</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">res</span> <span class="o">=</span><span class="n">dec</span><span class="p">(</span><span class="n">encbuff</span><span class="o">=</span><span class="n">buff</span><span class="p">,</span> <span class="n">key1</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">key2</span><span class="o">=</span><span class="n">temp_key2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="sa">b</span><span class="s1">&#39;moov&#39;</span> <span class="ow">in</span> <span class="n">res</span> <span class="ow">and</span> <span class="sa">b</span><span class="s1">&#39;mdat&#39;</span> <span class="ow">in</span> <span class="n">res</span><span class="p">):</span> <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;pdf&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">res</span> <span class="o">=</span> <span class="n">dec</span><span class="p">(</span><span class="n">encbuff</span><span class="o">=</span><span class="n">buff</span><span class="p">[:</span><span class="mi">7</span><span class="p">],</span> <span class="n">key1</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">key2</span><span class="o">=</span><span class="n">temp_key2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="n">Extensions</span><span class="o">.</span><span class="n">PDF</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">rounds</span> <span class="o">=</span> <span class="mi">16</span>
</span></span><span class="line"><span class="cl">    <span class="n">delta</span> <span class="o">=</span> <span class="mh">0x1A2B693C</span>
</span></span><span class="line"><span class="cl">    <span class="n">sumval</span> <span class="o">=</span> <span class="mh">0x00000000</span>
</span></span><span class="line"><span class="cl">    <span class="n">keys</span> <span class="o">=</span>  <span class="p">[</span><span class="mh">0x1234f</span><span class="p">,</span> <span class="mh">0x1bc0d</span><span class="p">,</span> <span class="mh">0x80112</span><span class="p">,</span> <span class="mh">0x4ef50</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">v0</span><span class="p">,</span> <span class="n">v1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">val</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rounds</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">sumval</span> <span class="o">+=</span> <span class="p">(</span><span class="n">delta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">v0</span> <span class="o">=</span> <span class="p">((((</span> <span class="p">(</span><span class="n">v1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">^</span> <span class="p">(</span><span class="n">v1</span> <span class="o">+</span> <span class="n">sumval</span> <span class="o">+</span> <span class="n">keys</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">^</span> <span class="p">((</span><span class="n">v1</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">))</span> <span class="o">+</span> <span class="n">keys</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">v1</span> <span class="o">=</span> <span class="n">v0</span>
</span></span><span class="line"><span class="cl">    <span class="n">val</span> <span class="o">=</span> <span class="n">v0</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">val</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_key1</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span><span class="p">(</span><span class="n">val</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">key</span> <span class="o">+=</span> <span class="n">MAPPINGS</span><span class="p">[</span><span class="n">val</span> <span class="o">%</span> <span class="mi">30</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">val</span> <span class="o">//=</span> <span class="mi">30</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">key</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">md5digestString</span><span class="p">(</span><span class="n">a</span><span class="p">):</span> <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Decryptor</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">key1</span> <span class="p">:</span> <span class="nb">bytes</span>  <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">key2</span> <span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">update_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key1</span> <span class="p">,</span> <span class="n">key2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">key1</span> <span class="o">=</span> <span class="n">key1</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">key2</span> <span class="o">=</span> <span class="n">key2</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encbuff</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">encbuff</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span><span class="p">[</span><span class="n">_</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">encbuff</span><span class="p">[</span><span class="n">_</span><span class="p">]</span> <span class="o">^</span> <span class="bp">self</span><span class="o">.</span><span class="n">key1</span><span class="p">[</span><span class="n">_</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key1</span><span class="p">)]</span> <span class="o">^</span> <span class="bp">self</span><span class="o">.</span><span class="n">key2</span><span class="p">[</span><span class="n">_</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key2</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key1</span> <span class="p">:</span> <span class="nb">bytes</span> <span class="p">,</span> <span class="n">key2</span> <span class="p">:</span> <span class="nb">bytes</span> <span class="p">,</span> <span class="n">encbuff</span> <span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytearray</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key1</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">key2</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">update_keys</span><span class="p">(</span><span class="n">key1</span><span class="o">=</span><span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="o">=</span><span class="n">key2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encbuff</span><span class="o">=</span><span class="n">encbuff</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">base_dir</span> <span class="o">=</span> <span class="s2">&#34;encrypted/&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0cf51fbc.tort&#39;</span><span class="p">,</span><span class="s1">&#39;a917438f.tort&#39;</span><span class="p">,</span><span class="s1">&#39;3a7fab71.tort&#39;</span><span class="p">,</span> <span class="s1">&#39;bb292337.tort&#39;</span><span class="p">,</span> <span class="s1">&#39;24819686.tort&#39;</span><span class="p">,</span> <span class="s1">&#39;7a6c7166.tort&#39;</span><span class="p">,</span> <span class="s1">&#39;185c65f8.tort&#39;</span><span class="p">,</span> <span class="s1">&#39;cc876a3b.tort&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ext</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span><span class="s1">&#39;gif&#39;</span><span class="p">,</span> <span class="s1">&#39;webp&#39;</span><span class="p">,</span> <span class="s1">&#39;docx&#39;</span><span class="p">,</span> <span class="s1">&#39;jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;rar&#39;</span><span class="p">,</span> <span class="s1">&#39;mp4&#39;</span><span class="p">,</span> <span class="s1">&#39;png&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">dec_files</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;15005-39026.pdf&#39;</span><span class="p">,</span><span class="s1">&#39;binary-01.gif&#39;</span><span class="p">,</span><span class="s1">&#39;Everest Vista.webp&#39;</span><span class="p">,</span><span class="s1">&#39;Paranormal Phenomenon.docx&#39;</span><span class="p">,</span><span class="s1">&#39;so-cappy.jpg&#39;</span><span class="p">,</span><span class="s1">&#39;stuffs.rar&#39;</span><span class="p">,</span><span class="s1">&#39;ySq12b0T.mp4&#39;</span><span class="p">,</span><span class="s1">&#39;vl36hkjkzbh91.png&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">time_exe</span> <span class="o">=</span> <span class="s2">&#34;/mnt/e/filetime.exe&#34;</span>  <span class="c1"># Compiled exe path</span>
</span></span><span class="line"><span class="cl">    <span class="n">timestamps</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;2010 2 2 26 12 38 43 0&#34;</span><span class="p">,</span><span class="s1">&#39;1995 2 2 27 2 11 42 0&#39;</span><span class="p">,</span> <span class="s1">&#39;1990 8 2 28 21 6 35 0&#39;</span><span class="p">,</span><span class="s1">&#39;1993 7 2 16 17 10 46 0&#39;</span><span class="p">,</span><span class="s1">&#39;2001 4 2 19 8 27 45 0&#39;</span><span class="p">,</span><span class="s1">&#39;2009 11 2 22 17 5 55 0&#39;</span><span class="p">,</span><span class="s1">&#39;2007 7 2 28 3 27 33 0&#39;</span><span class="p">,</span><span class="s1">&#39;1985 3 2 4 16 23 53 0&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">					<span class="n">w</span> <span class="o">=</span> <span class="n">Decryptor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;File : &#34;</span><span class="p">,</span> <span class="n">dec_files</span><span class="p">[</span><span class="n">_</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">enc_buff</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">base_dir</span><span class="si">}{</span><span class="n">files</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;rb&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()[</span><span class="mi">8</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">        <span class="n">key1</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">t</span> <span class="o">=</span> <span class="n">timestamps</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">out</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">time_exe</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">t</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">out</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">key1</span> <span class="o">+=</span> <span class="n">get_key1</span><span class="p">((</span><span class="n">out</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">),</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">key1</span> <span class="o">+=</span> <span class="n">get_key1</span><span class="p">((</span><span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">)</span> <span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">key1</span> <span class="o">+=</span> <span class="n">get_key1</span><span class="p">((</span><span class="n">encrypt</span><span class="p">((</span><span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">out</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">))</span> <span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">key1</span> <span class="o">+=</span> <span class="n">get_key1</span><span class="p">((</span><span class="n">encrypt</span><span class="p">((</span><span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">out</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">))</span> <span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">key1</span> <span class="o">+=</span> <span class="n">get_key1</span><span class="p">((</span><span class="n">encrypt</span><span class="p">((</span><span class="n">out</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">out</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">))</span> <span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">nonce</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">nonce</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">passw</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;passwd.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">while</span><span class="p">(</span><span class="n">t</span><span class="o">:=</span> <span class="n">passw</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
</span></span><span class="line"><span class="cl">                <span class="n">temp</span> <span class="o">=</span> <span class="n">key1</span> <span class="o">+</span> <span class="n">t</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">status</span> <span class="o">=</span> <span class="n">check_header</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">enc_buff</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span><span class="n">ext</span><span class="p">[</span><span class="n">_</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                    <span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">nonce</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[+] Found for </span><span class="si">{</span><span class="n">files</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="si">}</span><span class="s1"> :: nonce : </span><span class="si">{</span><span class="n">nonce</span><span class="si">}</span><span class="s1"> key1 : </span><span class="si">{</span><span class="n">key1</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}{</span><span class="n">nonce</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">key1</span> <span class="o">+=</span> <span class="n">nonce</span>
</span></span><span class="line"><span class="cl">        <span class="n">key2</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">key1</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">dec</span> <span class="o">=</span> <span class="n">w</span><span class="p">(</span><span class="n">encbuff</span><span class="o">=</span><span class="n">enc_buff</span><span class="p">,</span> <span class="n">key1</span><span class="o">=</span> <span class="n">key1</span><span class="p">,</span> <span class="n">key2</span><span class="o">=</span> <span class="n">key2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;decrypted/</span><span class="si">{</span><span class="n">dec_files</span><span class="p">[</span><span class="n">_</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span>
</span></span></code></pre></div><p><img src="/posts/resilient-file-system/images/image-37.png" alt="AltText"></p>
<p>Let&rsquo;s calculate md5sum of each file</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">da8ed3e98eb5a2ba769ea60b48b0f6eb  15005-39026.pdf
</span></span><span class="line"><span class="cl">d58621ce6e560ba1c045892aef0b5f8b  binary-01.gif
</span></span><span class="line"><span class="cl">683092bd6640e62a3dc49b412da4fe71  Everest Vista.webp
</span></span><span class="line"><span class="cl">11d9788ce48371a6ef230892ada1554d  Paranormal Phenomenon.docx
</span></span><span class="line"><span class="cl">bc9a53c83976e9779bce2d0635f1bbbe  so-cappy.jpg
</span></span><span class="line"><span class="cl">111fb8624db9365af79e6ec446b00eac  stuffs.rar
</span></span><span class="line"><span class="cl">76675928a19bcc5602ef81c7a833d3fa  vl36hkjkzbh91.png
</span></span><span class="line"><span class="cl">4d9c5a006c4315625c86d94a8fd9fd2e  ySq12b0T.mp4
</span></span></code></pre></div><p><img src="/posts/resilient-file-system/images/image-506.png" alt="alt text"></p>
<p><strong>Final Ans</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="s1">&#39;da8ed3e98eb5a2ba769ea60b48b0f6eb&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="s1">&#39;d58621ce6e560ba1c045892aef0b5f8b&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="s1">&#39;683092bd6640e62a3dc49b412da4fe71&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="s1">&#39;11d9788ce48371a6ef230892ada1554d&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="s1">&#39;bc9a53c83976e9779bce2d0635f1bbbe&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="s1">&#39;111fb8624db9365af79e6ec446b00eac&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="s1">&#39;76675928a19bcc5602ef81c7a833d3fa&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="s1">&#39;4d9c5a006c4315625c86d94a8fd9fd2e&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p><strong>Flag</strong> : <code>bi0sctf{ReAL_1_w0nd3r_wHa7_t1m3_is_17_14dbc653fdb414c1d}</code></p>
<h2 id="references">References<a href="#references" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<ul>
<li>
<p><a href="https://www.sciencedirect.com/science/article/pii/S2666281723001191?ref=pdf_download&amp;fr=RR-2&amp;rr=857d87e5a8047866">Deletion Pattern in ReFS</a></p>
</li>
<li>
<p><a href="https://www.sciencedirect.com/science/article/pii/S2666281721000342?ref=pdf_download&amp;fr=RR-2&amp;rr=857d87e5a8037866">Forensic Analysis of ReFS Journaling</a></p>
</li>
<li>
<p><a href="https://www.sciencedirect.com/science/article/pii/S1742287619301252?ref=pdf_download&amp;fr=RR-2&amp;rr=858e699298bd7868">Reverse Engineering of ReFS</a></p>
</li>
<li>
<p><a href="https://github.com/horensic/ARIN">Awesome ReFS Investigation tool</a></p>
</li>
<li>
<p><a href="https://github.com/jamemanionda/ReFS_Detector">ReFS Detector</a></p>
</li>
</ul>
<hr>
<p><strong>Contact</strong>: <strong>Sabhya Raj Mehta(5h4rrK)</strong> | <a href="https://twitter.com/5h4rrK">Twitter</a> |  <a href="https://github.com/5h4rrK">GitHub</a> |   <a href="https://linkedin.com/in/sabhya05">LinkedIn</a></p>
      </div></div>

  
    
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h"></span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        <span class="button previous">
            <a href="http://localhost:1313/posts/pe-parse-windbg/">
                <span class="button__icon">←</span>
                <span class="button__text">PE Parsing: A Step-by-Step Guide with WinDbg - Part 1</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="http://localhost:1313/posts/keyboard-pcap/">
                <span class="button__text">Network-KeyLogger</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2025 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/mirus-ua/hugo-theme-re-terminal" target="_blank">Theme</a> made by <a href="https://github.com/mirus-ua" target="_blank">Mirus</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>








  
</div>

</body>
</html>
